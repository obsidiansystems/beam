
<!DOCTYPE html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
      
        <link rel="shortcut icon" href="../../../assets/images/favicon.png">
      
      <meta name="generator" content="mkdocs-0.16.2, mkdocs-material-1.6.1">
    
    
      
        <title>Aggregates - Beam Documentation</title>
      
    
    
      <script src="../../../assets/javascripts/modernizr-56ade86843.js"></script>
    
    

      <link rel="stylesheet" href="../../../assets/stylesheets/application-4d0d3f2fbf.css">
      
    
<link rel="stylesheet" type="text/css" href="/css/beam.css"/>

    
      
        
        
        
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,400,400i,700|Roboto+Mono">
        <style>body,input{font-family:"Roboto","Helvetica Neue",Helvetica,Arial,sans-serif}code,kbd,pre{font-family:"Roboto Mono","Courier New",Courier,monospace}</style>
      
      <link rel="stylesheet" href="https://fonts.googleapis.com/icon?family=Material+Icons">
    
    
      <link rel="stylesheet" href="../../../theme/css/beam.css">
    
    
  </head>
  
  
  
  
    <body>
  
    <svg class="md-svg">
      <defs>
        
        
          <svg xmlns="http://www.w3.org/2000/svg" width="416" height="448" viewBox="0 0 416 448" id="github"><path fill="currentColor" d="M160 304q0 10-3.125 20.5t-10.75 19T128 352t-18.125-8.5-10.75-19T96 304t3.125-20.5 10.75-19T128 256t18.125 8.5 10.75 19T160 304zm160 0q0 10-3.125 20.5t-10.75 19T288 352t-18.125-8.5-10.75-19T256 304t3.125-20.5 10.75-19T288 256t18.125 8.5 10.75 19T320 304zm40 0q0-30-17.25-51T296 232q-10.25 0-48.75 5.25Q229.5 240 208 240t-39.25-2.75Q130.75 232 120 232q-29.5 0-46.75 21T56 304q0 22 8 38.375t20.25 25.75 30.5 15 35 7.375 37.25 1.75h42q20.5 0 37.25-1.75t35-7.375 30.5-15 20.25-25.75T360 304zm56-44q0 51.75-15.25 82.75-9.5 19.25-26.375 33.25t-35.25 21.5-42.5 11.875-42.875 5.5T212 416q-19.5 0-35.5-.75t-36.875-3.125-38.125-7.5-34.25-12.875T37 371.5t-21.5-28.75Q0 312 0 260q0-59.25 34-99-6.75-20.5-6.75-42.5 0-29 12.75-54.5 27 0 47.5 9.875t47.25 30.875Q171.5 96 212 96q37 0 70 8 26.25-20.5 46.75-30.25T376 64q12.75 25.5 12.75 54.5 0 21.75-6.75 42 34 40 34 99.5z"/></svg>
        
      </defs>
    </svg>
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="drawer">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="search">
    <label class="md-overlay" data-md-component="overlay" for="drawer"></label>
    
      <header class="md-header" data-md-component="header">
  <nav class="md-header-nav md-grid">
    <div class="md-flex">
      <div class="md-flex__cell md-flex__cell--shrink">
        
          <a href="../../.." title="Beam Documentation" class="md-logo md-header-nav__button">
            <img src="../../../img/logo.svg" width="24" height="24">
          </a>
        
      </div>
      <div class="md-flex__cell md-flex__cell--shrink">
        <label class="md-icon md-icon--menu md-header-nav__button" for="drawer"></label>
      </div>
      <div class="md-flex__cell md-flex__cell--stretch">
        <span class="md-flex__ellipsis md-header-nav__title">
          
            
              
                <span class="md-header-nav__parent">
                  User Guide
                </span>
              
                <span class="md-header-nav__parent">
                  Queries
                </span>
              
            
            Aggregates
          
        </span>
      </div>
      <div class="md-flex__cell md-flex__cell--shrink">
        
          <label class="md-icon md-icon--search md-header-nav__button" for="search"></label>
          
<div class="md-search" data-md-component="search">
  <label class="md-search__overlay" for="search"></label>
  <div class="md-search__inner">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" required placeholder="Search" accesskey="s" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="query">
      <label class="md-icon md-search__icon" for="search"></label>
      <button type="reset" class="md-icon md-search__icon" data-md-component="reset">close</button>
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="result">
          <div class="md-search-result__meta" data-md-lang-result-none="No matching documents" data-md-lang-result-one="1 matching document" data-md-lang-result-other="# matching documents">
            Type to start searching
          </div>
          <ol class="md-search-result__list"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
        
      </div>
      <div class="md-flex__cell md-flex__cell--shrink">
        <div class="md-header-nav__source">
          
            


  


  <a href="https://github.com/tathougies/beam" title="Go to repository" class="md-source" data-md-source="github">
    
      <div class="md-source__icon">
        <svg viewBox="0 0 24 24" width="24" height="24">
          <use xlink:href="#github" width="24" height="24"></use>
        </svg>
      </div>
    
    <div class="md-source__repository">
      tathougies/beam
    </div>
  </a>

          
        </div>
      </div>
    </div>
  </nav>
</header>
    
    <div class="md-container">
      
      
      <main class="md-main">
        <div class="md-main__inner md-grid" data-md-component="container">
          
            
              <div class="md-sidebar md-sidebar--primary" data-md-component="navigation">
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    <nav class="md-nav md-nav--primary" data-md-level="0">
  <label class="md-nav__title md-nav__title--site" for="drawer">
    
      <i class="md-logo md-nav__button">
        <img src="../../../img/logo.svg">
      </i>
    
    Beam Documentation
  </label>
  
    <div class="md-nav__source">
      


  


  <a href="https://github.com/tathougies/beam" title="Go to repository" class="md-source" data-md-source="github">
    
      <div class="md-source__icon">
        <svg viewBox="0 0 24 24" width="24" height="24">
          <use xlink:href="#github" width="24" height="24"></use>
        </svg>
      </div>
    
    <div class="md-source__repository">
      tathougies/beam
    </div>
  </a>

    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
      


  <li class="md-nav__item">
    <a href="../../.." title="Home" class="md-nav__link">
      Home
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../../../about/faq/" title="Frequently Asked Questions" class="md-nav__link">
      Frequently Asked Questions
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-3" type="checkbox" id="nav-3">
    
    <label class="md-nav__link" for="nav-3">
      Tutorial
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-3">
        Tutorial
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../../tutorials/tutorial1/" title="Part 1" class="md-nav__link">
      Part 1
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../tutorials/tutorial2/" title="Part 2" class="md-nav__link">
      Part 2
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../tutorials/tutorial3/" title="Part 3" class="md-nav__link">
      Part 3
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      

  


  <li class="md-nav__item md-nav__item--active md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-4" type="checkbox" id="nav-4" checked>
    
    <label class="md-nav__link" for="nav-4">
      User Guide
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-4">
        User Guide
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../models/" title="Models" class="md-nav__link">
      Models
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../databases/" title="Databases" class="md-nav__link">
      Databases
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../backends/" title="Backends" class="md-nav__link">
      Backends
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../expressions/" title="Expressions" class="md-nav__link">
      Expressions
    </a>
  </li>

        
          
          
          

  


  <li class="md-nav__item md-nav__item--active md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-4-5" type="checkbox" id="nav-4-5" checked>
    
    <label class="md-nav__link" for="nav-4-5">
      Queries
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="2">
      <label class="md-nav__title" for="nav-4-5">
        Queries
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../basic/" title="Basic Queries" class="md-nav__link">
      Basic Queries
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../select/" title="More complex SELECTs" class="md-nav__link">
      More complex SELECTs
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../ordering/" title="Ordering" class="md-nav__link">
      Ordering
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../relationships/" title="Relationships" class="md-nav__link">
      Relationships
    </a>
  </li>

        
          
          
          

  


  <li class="md-nav__item md-nav__item--active">
    
    <input class="md-toggle md-nav__toggle" data-md-toggle="toc" type="checkbox" id="toc">
    
    
      <label class="md-nav__link md-nav__link--active" for="toc">
        Aggregates
      </label>
    
    <a href="./" title="Aggregates" class="md-nav__link md-nav__link--active">
      Aggregates
    </a>
    
      
<nav class="md-nav md-nav--secondary">
  
  
  
    <label class="md-nav__title" for="toc">Table of contents</label>
    <ul class="md-nav__list" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#simple-aggregate-usage" title="Simple aggregate usage" class="md-nav__link">
    Simple aggregate usage
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#adding-a-group-by-clause" title="Adding a GROUP BY clause" class="md-nav__link">
    Adding a GROUP BY clause
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#sql-compatibility" title="SQL compatibility" class="md-nav__link">
    SQL compatibility
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#the-having-clause" title="The HAVING clause" class="md-nav__link">
    The HAVING clause
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
      
      
    </ul>
  
</nav>
    
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../combining-queries/" title="Combining queries" class="md-nav__link">
      Combining queries
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../window-functions/" title="Window functions" class="md-nav__link">
      Window functions
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../advanced-features/" title="Advanced features" class="md-nav__link">
      Advanced features
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../extensibility/" title="Custom queries" class="md-nav__link">
      Custom queries
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-4-7" type="checkbox" id="nav-4-7">
    
    <label class="md-nav__link" for="nav-4-7">
      Data Manipulation
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="2">
      <label class="md-nav__title" for="nav-4-7">
        Data Manipulation
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../manipulation/insert/" title="INSERT" class="md-nav__link">
      INSERT
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../manipulation/update/" title="UPDATE" class="md-nav__link">
      UPDATE
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../manipulation/delete/" title="DELETE" class="md-nav__link">
      DELETE
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-5" type="checkbox" id="nav-5">
    
    <label class="md-nav__link" for="nav-5">
      Schema management
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-5">
        Schema management
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../../schema-guide/migrations/" title="The Migrations Framework" class="md-nav__link">
      The Migrations Framework
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../schema-guide/tool/" title="The beam-migrate tool" class="md-nav__link">
      The beam-migrate tool
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../schema-guide/supported/" title="Supported migrations" class="md-nav__link">
      Supported migrations
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-6" type="checkbox" id="nav-6">
    
    <label class="md-nav__link" for="nav-6">
      Backends
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-6">
        Backends
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../backends/beam-postgres/" title="beam-postgres" class="md-nav__link">
      beam-postgres
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../backends/beam-sqlite/" title="beam-sqlite" class="md-nav__link">
      beam-sqlite
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../custom-backends/" title="Writing a Custom Backend" class="md-nav__link">
      Writing a Custom Backend
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-7" type="checkbox" id="nav-7">
    
    <label class="md-nav__link" for="nav-7">
      About
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-7">
        About
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../../about/compatibility/" title="Compatibility Matrix" class="md-nav__link">
      Compatibility Matrix
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../about/license/" title="License" class="md-nav__link">
      License
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../about/release-notes/" title="Release Notes" class="md-nav__link">
      Release Notes
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              <div class="md-sidebar md-sidebar--secondary" data-md-component="toc">
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    
<nav class="md-nav md-nav--secondary">
  
  
  
    <label class="md-nav__title" for="toc">Table of contents</label>
    <ul class="md-nav__list" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#simple-aggregate-usage" title="Simple aggregate usage" class="md-nav__link">
    Simple aggregate usage
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#adding-a-group-by-clause" title="Adding a GROUP BY clause" class="md-nav__link">
    Adding a GROUP BY clause
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#sql-compatibility" title="SQL compatibility" class="md-nav__link">
    SQL compatibility
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#the-having-clause" title="The HAVING clause" class="md-nav__link">
    The HAVING clause
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
      
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          <div class="md-content">
            <article class="md-content__inner md-typeset">
              
                
                
                  <h1>Aggregates</h1>
                
                <p>You can use the <code>aggregate_</code> function to group your result set and compute
aggregates within the group. You can think of <code>aggregate_</code> as a souped up
version of Haskell's <code>groupBy</code>.</p>
<p>You use <code>aggregate_</code> by specifying an underlying query to run and a function
that produces an aggregation projection. An aggregation projection is either a
value of type <code>QAgg syntax s a</code>, a value of type <code>QGroupExpr syntax s a</code>, or a
tuple of such values. Any <code>QGenExpr</code> that uses an aggregate function is
automatically assigned the <code>QAgg syntax s a</code> type. Any <code>QGenExpr</code> that contains
the <code>group_</code> combinator is given the type <code>QGroupExpr</code>.</p>
<p>During query generation, the expressions of type <code>QGroupExpr</code> are added to the
<code>GROUP BY</code> clause, and expressions of type <code>QAgg</code> are treated as aggregation to
be computed.</p>
<p>The result of the <code>aggregate_</code> lifts all the <code>QAgg</code>s and <code>QGroupExpr</code>s to
'regular' value-level <code>QExpr</code>s, so the result of <code>aggregate_</code> can be used in
expressions as usual.</p>
<h2 id="simple-aggregate-usage">Simple aggregate usage</h2>
<p>Suppose we wanted to count the number of genres in our database.</p>
<p>
                <div class="code-nav-container">
                    
        <ul class="nav nav-tabs">
            
        <li class="nav-item">
            <a href="#tab-0-Haskell" aria-controls="tab-0-Haskell" role="tab" data-toggle="tab" data-lang="haskell">Haskell</a>
        </li>
    
        <li class="nav-item">
            <a href="#tab-0-Sqlite" aria-controls="tab-0-Sqlite" role="tab" data-toggle="tab" data-lang="sql">Sqlite</a>
        </li>
    
        <li class="nav-item">
            <a href="#tab-0-Postgres" aria-controls="tab-0-Postgres" role="tab" data-toggle="tab" data-lang="sql">Postgres</a>
        </li>
    
        </ul>
    
        <div class="tab-content">
            
        <div role="tabpanel" class="tab-pane active" id="tab-0-Haskell">
            <div class="codehilite"><pre><span></span><span class="nf">aggregate_</span> <span class="p">(</span><span class="nf">\</span><span class="kr">_</span> <span class="ow">-&gt;</span> <span class="n">countAll_</span><span class="p">)</span> <span class="p">(</span><span class="n">all_</span> <span class="p">(</span><span class="n">genre</span> <span class="n">chinookDb</span><span class="p">))</span>
</pre></div>

        </div>
    
        <div role="tabpanel" class="tab-pane " id="tab-0-Sqlite">
            <div class="codehilite"><pre><span></span><span class="k">SELECT</span> <span class="k">COUNT</span><span class="p">(</span><span class="o">*</span><span class="p">)</span> <span class="k">AS</span> <span class="ss">&quot;res0&quot;</span>
<span class="k">FROM</span> <span class="ss">&quot;Genre&quot;</span> <span class="k">AS</span> <span class="ss">&quot;t0&quot;</span><span class="p">;</span>

<span class="c1">-- With values: []</span>
</pre></div>

        </div>
    
        <div role="tabpanel" class="tab-pane " id="tab-0-Postgres">
            <div class="codehilite"><pre><span></span><span class="k">SELECT</span> <span class="k">COUNT</span><span class="p">(</span><span class="o">*</span><span class="p">)</span> <span class="k">AS</span> <span class="ss">&quot;res0&quot;</span>
<span class="k">FROM</span> <span class="ss">&quot;Genre&quot;</span> <span class="k">AS</span> <span class="ss">&quot;t0&quot;</span>
</pre></div>

        </div>
    
        </div>
    
                </div>
                    </p>
<h3 id="adding-a-group-by-clause">Adding a GROUP BY clause</h3>
<p>Above, SQL used the default grouping, which puts all rows in one group. We can
also specify columns and expressions to group by. For example, if we wanted to
count the number of tracks for each genre, we can use the <code>group_</code> function to
group by the genre.</p>
<p>
                <div class="code-nav-container">
                    
        <ul class="nav nav-tabs">
            
        <li class="nav-item">
            <a href="#tab-1-Haskell" aria-controls="tab-1-Haskell" role="tab" data-toggle="tab" data-lang="haskell">Haskell</a>
        </li>
    
        <li class="nav-item">
            <a href="#tab-1-Sqlite" aria-controls="tab-1-Sqlite" role="tab" data-toggle="tab" data-lang="sql">Sqlite</a>
        </li>
    
        <li class="nav-item">
            <a href="#tab-1-Postgres" aria-controls="tab-1-Postgres" role="tab" data-toggle="tab" data-lang="sql">Postgres</a>
        </li>
    
        </ul>
    
        <div class="tab-content">
            
        <div role="tabpanel" class="tab-pane active" id="tab-1-Haskell">
            <div class="codehilite"><pre><span></span><span class="nf">aggregate_</span> <span class="p">(</span><span class="nf">\</span><span class="p">(</span><span class="n">genre</span><span class="p">,</span> <span class="n">track</span><span class="p">)</span> <span class="ow">-&gt;</span> <span class="p">(</span><span class="n">group_</span> <span class="n">genre</span><span class="p">,</span> <span class="n">as_</span> <span class="o">@</span><span class="kt">Int</span> <span class="o">$</span> <span class="n">count_</span> <span class="p">(</span><span class="n">trackId</span> <span class="n">track</span><span class="p">)))</span>
           <span class="p">((,)</span> <span class="o">&lt;$&gt;</span> <span class="n">all_</span> <span class="p">(</span><span class="n">genre</span> <span class="n">chinookDb</span><span class="p">)</span> <span class="o">&lt;*&gt;</span> <span class="n">all_</span> <span class="p">(</span><span class="n">track</span> <span class="n">chinookDb</span><span class="p">))</span>
</pre></div>

        </div>
    
        <div role="tabpanel" class="tab-pane " id="tab-1-Sqlite">
            <div class="codehilite"><pre><span></span><span class="k">SELECT</span> <span class="ss">&quot;t0&quot;</span><span class="p">.</span><span class="ss">&quot;GenreId&quot;</span> <span class="k">AS</span> <span class="ss">&quot;res0&quot;</span><span class="p">,</span>
       <span class="ss">&quot;t0&quot;</span><span class="p">.</span><span class="ss">&quot;Name&quot;</span> <span class="k">AS</span> <span class="ss">&quot;res1&quot;</span><span class="p">,</span>
       <span class="k">COUNT</span><span class="p">(</span><span class="ss">&quot;t1&quot;</span><span class="p">.</span><span class="ss">&quot;TrackId&quot;</span><span class="p">)</span> <span class="k">AS</span> <span class="ss">&quot;res2&quot;</span>
<span class="k">FROM</span> <span class="ss">&quot;Genre&quot;</span> <span class="k">AS</span> <span class="ss">&quot;t0&quot;</span>
<span class="k">INNER</span> <span class="k">JOIN</span> <span class="ss">&quot;Track&quot;</span> <span class="k">AS</span> <span class="ss">&quot;t1&quot;</span>
<span class="k">GROUP</span> <span class="k">BY</span> <span class="ss">&quot;t0&quot;</span><span class="p">.</span><span class="ss">&quot;GenreId&quot;</span><span class="p">,</span>
         <span class="ss">&quot;t0&quot;</span><span class="p">.</span><span class="ss">&quot;Name&quot;</span><span class="p">;</span>

<span class="c1">-- With values: []</span>
</pre></div>

        </div>
    
        <div role="tabpanel" class="tab-pane " id="tab-1-Postgres">
            <div class="codehilite"><pre><span></span><span class="k">SELECT</span> <span class="ss">&quot;t0&quot;</span><span class="p">.</span><span class="ss">&quot;GenreId&quot;</span> <span class="k">AS</span> <span class="ss">&quot;res0&quot;</span><span class="p">,</span>
       <span class="ss">&quot;t0&quot;</span><span class="p">.</span><span class="ss">&quot;Name&quot;</span> <span class="k">AS</span> <span class="ss">&quot;res1&quot;</span><span class="p">,</span>
       <span class="k">COUNT</span><span class="p">(</span><span class="ss">&quot;t1&quot;</span><span class="p">.</span><span class="ss">&quot;TrackId&quot;</span><span class="p">)</span> <span class="k">AS</span> <span class="ss">&quot;res2&quot;</span>
<span class="k">FROM</span> <span class="ss">&quot;Genre&quot;</span> <span class="k">AS</span> <span class="ss">&quot;t0&quot;</span>
<span class="k">CROSS</span> <span class="k">JOIN</span> <span class="ss">&quot;Track&quot;</span> <span class="k">AS</span> <span class="ss">&quot;t1&quot;</span>
<span class="k">GROUP</span> <span class="k">BY</span> <span class="ss">&quot;t0&quot;</span><span class="p">.</span><span class="ss">&quot;GenreId&quot;</span><span class="p">,</span>
         <span class="ss">&quot;t0&quot;</span><span class="p">.</span><span class="ss">&quot;Name&quot;</span>
</pre></div>

        </div>
    
        </div>
    
                </div>
                    </p>
<div class="admonition tip">
<p class="admonition-title">Tip</p>
<p><code>count_</code> can return any <code>Integral</code> type. Adding the explicit <code>as_ @Int</code> above
prevents an ambiguous type error.</p>
</div>
<h2 id="sql-compatibility">SQL compatibility</h2>
<p>Above, we demonstrated the use of <code>count_</code> and <code>countAll_</code> which map to the
appropriate SQL aggregates. Beam supports all of the other standard SQL92
aggregates.</p>
<p>In general, SQL aggregates are named similarly in beam and SQL. As usual, the
aggregate function in beam is suffixed by an underscore. For example, <code>sum_</code>
corresponds to the SQL aggregate <code>SUM</code>.</p>
<p>SQL also allows you to specify set quantifiers for each aggregate. Beam supports
these as well. By convention, versions of aggregates that take in an optional
set quantifier are suffixed by <code>Over</code>. For example <code>SUM(DISTINCT x)</code> can be
written <code>sumOver_ distinctInGroup_ x</code>. The universally quantified version of
each aggregate is obtained by using the <code>allInGroup_</code> quantifier. Thus, <code>sum_ ==
sumOver_ allInGroup_</code>. Because <code>ALL</code> is the default set quantifier, beam does
not typically generate it in queries. If, for some reason, you would like beam
to be explicit about it, you can use the <code>allInGroupExplicitly_</code> quantifier.</p>
<p>
                <div class="code-nav-container">
                    
        <ul class="nav nav-tabs">
            
        <li class="nav-item">
            <a href="#tab-2-Haskell" aria-controls="tab-2-Haskell" role="tab" data-toggle="tab" data-lang="haskell">Haskell</a>
        </li>
    
        <li class="nav-item">
            <a href="#tab-2-Sqlite" aria-controls="tab-2-Sqlite" role="tab" data-toggle="tab" data-lang="sql">Sqlite</a>
        </li>
    
        <li class="nav-item">
            <a href="#tab-2-Postgres" aria-controls="tab-2-Postgres" role="tab" data-toggle="tab" data-lang="sql">Postgres</a>
        </li>
    
        </ul>
    
        <div class="tab-content">
            
        <div role="tabpanel" class="tab-pane active" id="tab-2-Haskell">
            <div class="codehilite"><pre><span></span><span class="nf">aggregate_</span> <span class="p">(</span><span class="nf">\</span><span class="p">(</span><span class="n">genre</span><span class="p">,</span> <span class="n">track</span><span class="p">)</span> <span class="ow">-&gt;</span>
              <span class="p">(</span> <span class="n">group_</span> <span class="n">genre</span>
              <span class="p">,</span> <span class="n">as_</span> <span class="o">@</span><span class="kt">Int</span> <span class="o">$</span> <span class="n">countOver_</span> <span class="n">distinctInGroup_</span> <span class="p">(</span><span class="n">trackUnitPrice</span> <span class="n">track</span><span class="p">)</span>
              <span class="p">,</span> <span class="n">fromMaybe_</span> <span class="mi">0</span> <span class="p">(</span><span class="n">sumOver_</span> <span class="n">allInGroupExplicitly_</span> <span class="p">(</span><span class="n">trackMilliseconds</span> <span class="n">track</span><span class="p">))</span> <span class="p">`</span><span class="n">div_</span><span class="p">`</span> <span class="mi">1000</span> <span class="p">))</span> <span class="o">$</span>
           <span class="p">((,)</span> <span class="o">&lt;$&gt;</span> <span class="n">all_</span> <span class="p">(</span><span class="n">genre</span> <span class="n">chinookDb</span><span class="p">)</span> <span class="o">&lt;*&gt;</span> <span class="n">all_</span> <span class="p">(</span><span class="n">track</span> <span class="n">chinookDb</span><span class="p">))</span>
</pre></div>

        </div>
    
        <div role="tabpanel" class="tab-pane " id="tab-2-Sqlite">
            <div class="codehilite"><pre><span></span><span class="k">SELECT</span> <span class="ss">&quot;t0&quot;</span><span class="p">.</span><span class="ss">&quot;GenreId&quot;</span> <span class="k">AS</span> <span class="ss">&quot;res0&quot;</span><span class="p">,</span>
       <span class="ss">&quot;t0&quot;</span><span class="p">.</span><span class="ss">&quot;Name&quot;</span> <span class="k">AS</span> <span class="ss">&quot;res1&quot;</span><span class="p">,</span>
       <span class="k">COUNT</span><span class="p">(</span><span class="k">DISTINCT</span> <span class="ss">&quot;t1&quot;</span><span class="p">.</span><span class="ss">&quot;UnitPrice&quot;</span><span class="p">)</span> <span class="k">AS</span> <span class="ss">&quot;res2&quot;</span><span class="p">,</span>
       <span class="p">(</span><span class="n">COALESCE</span><span class="p">(</span><span class="k">SUM</span><span class="p">(</span><span class="k">ALL</span> <span class="ss">&quot;t1&quot;</span><span class="p">.</span><span class="ss">&quot;Milliseconds&quot;</span><span class="p">),</span> <span class="o">?</span><span class="p">))</span> <span class="o">/</span> <span class="p">(</span><span class="o">?</span><span class="p">)</span> <span class="k">AS</span> <span class="ss">&quot;res3&quot;</span>
<span class="k">FROM</span> <span class="ss">&quot;Genre&quot;</span> <span class="k">AS</span> <span class="ss">&quot;t0&quot;</span>
<span class="k">INNER</span> <span class="k">JOIN</span> <span class="ss">&quot;Track&quot;</span> <span class="k">AS</span> <span class="ss">&quot;t1&quot;</span>
<span class="k">GROUP</span> <span class="k">BY</span> <span class="ss">&quot;t0&quot;</span><span class="p">.</span><span class="ss">&quot;GenreId&quot;</span><span class="p">,</span>
         <span class="ss">&quot;t0&quot;</span><span class="p">.</span><span class="ss">&quot;Name&quot;</span><span class="p">;</span>

<span class="c1">-- With values: [SQLInteger 0,SQLInteger 1000]</span>
</pre></div>

        </div>
    
        <div role="tabpanel" class="tab-pane " id="tab-2-Postgres">
            <div class="codehilite"><pre><span></span><span class="k">SELECT</span> <span class="ss">&quot;t0&quot;</span><span class="p">.</span><span class="ss">&quot;GenreId&quot;</span> <span class="k">AS</span> <span class="ss">&quot;res0&quot;</span><span class="p">,</span>
       <span class="ss">&quot;t0&quot;</span><span class="p">.</span><span class="ss">&quot;Name&quot;</span> <span class="k">AS</span> <span class="ss">&quot;res1&quot;</span><span class="p">,</span>
       <span class="k">COUNT</span><span class="p">(</span><span class="k">DISTINCT</span> <span class="ss">&quot;t1&quot;</span><span class="p">.</span><span class="ss">&quot;UnitPrice&quot;</span><span class="p">)</span> <span class="k">AS</span> <span class="ss">&quot;res2&quot;</span><span class="p">,</span>
       <span class="p">(</span><span class="n">COALESCE</span><span class="p">(</span><span class="k">SUM</span><span class="p">(</span><span class="k">ALL</span> <span class="ss">&quot;t1&quot;</span><span class="p">.</span><span class="ss">&quot;Milliseconds&quot;</span><span class="p">),</span> <span class="mi">0</span><span class="p">))</span> <span class="o">/</span> <span class="p">(</span><span class="mi">1000</span><span class="p">)</span> <span class="k">AS</span> <span class="ss">&quot;res3&quot;</span>
<span class="k">FROM</span> <span class="ss">&quot;Genre&quot;</span> <span class="k">AS</span> <span class="ss">&quot;t0&quot;</span>
<span class="k">CROSS</span> <span class="k">JOIN</span> <span class="ss">&quot;Track&quot;</span> <span class="k">AS</span> <span class="ss">&quot;t1&quot;</span>
<span class="k">GROUP</span> <span class="k">BY</span> <span class="ss">&quot;t0&quot;</span><span class="p">.</span><span class="ss">&quot;GenreId&quot;</span><span class="p">,</span>
         <span class="ss">&quot;t0&quot;</span><span class="p">.</span><span class="ss">&quot;Name&quot;</span>
</pre></div>

        </div>
    
        </div>
    
                </div>
                    </p>
<div class="admonition tip">
<p class="admonition-title">Tip</p>
<p>Most Beam aggregates (<code>count_</code> and <code>countAll_</code> being an exception) return a
<code>Maybe</code> value, because aggregating over no rows in SQL returns a <code>NULL</code>
value. Use <code>fromMaybe_</code> or <code>coalesce_</code> to supply a default value in this case.</p>
</div>
<p>The <code>beam-core</code> library supports the standard SQL aggregation functions.
Individual backends are likely to support the full range of aggregates available
on that backend (if not, please send a bug report).</p>
<table>
<thead>
<tr>
<th align="left">SQL Aggregate</th>
<th align="center">Relevant standard</th>
<th align="left">Unquantified beam function</th>
<th align="left">Quantified beam function</th>
</tr>
</thead>
<tbody>
<tr>
<td align="left">SUM</td>
<td align="center">SQL92</td>
<td align="left"><code>sum_</code></td>
<td align="left"><code>sumOver_</code></td>
</tr>
<tr>
<td align="left">MIN</td>
<td align="center">SQL92</td>
<td align="left"><code>min_</code></td>
<td align="left"><code>minOver_</code></td>
</tr>
<tr>
<td align="left">MAX</td>
<td align="center">SQL92</td>
<td align="left"><code>max_</code></td>
<td align="left"><code>maxOver_</code></td>
</tr>
<tr>
<td align="left">AVG</td>
<td align="center">SQL92</td>
<td align="left"><code>avg_</code></td>
<td align="left"><code>avgOver_</code></td>
</tr>
<tr>
<td align="left">COUNT(x)</td>
<td align="center">SQL92</td>
<td align="left"><code>count_</code></td>
<td align="left"><code>countOver_</code></td>
</tr>
<tr>
<td align="left">COUNT(*)</td>
<td align="center">SQL92</td>
<td align="left"><code>countAll_</code></td>
<td align="left">N/A</td>
</tr>
<tr>
<td align="left">EVERY(x)</td>
<td align="center">SQL99</td>
<td align="left"><code>every_</code></td>
<td align="left"><code>everyOver_</code></td>
</tr>
<tr>
<td align="left">ANY(x)/SOME(x)</td>
<td align="center">SQL99</td>
<td align="left"><code>any_</code>, <code>some_</code></td>
<td align="left"><code>anyOver_</code>, <code>someOver_</code></td>
</tr>
</tbody>
</table>
<h3 id="the-having-clause">The <code>HAVING</code> clause</h3>
<p>SQL allows users to specify a <code>HAVING</code> condition to filter results based on the
computed result of an aggregate. Beam fully supports <code>HAVIVG</code> clauses, but does
not use any special syntax. Simply use <code>filter_</code> or <code>guard_</code> as usual, and beam
will add a <code>HAVING</code> clause if it forms legal SQL. Otherwise, beam will create a
subselect and add a <code>WHERE</code> clause. Either way, this is transparent to the user.</p>
<p>
                <div class="code-nav-container">
                    
        <ul class="nav nav-tabs">
            
        <li class="nav-item">
            <a href="#tab-3-Haskell" aria-controls="tab-3-Haskell" role="tab" data-toggle="tab" data-lang="haskell">Haskell</a>
        </li>
    
        <li class="nav-item">
            <a href="#tab-3-Sqlite" aria-controls="tab-3-Sqlite" role="tab" data-toggle="tab" data-lang="sql">Sqlite</a>
        </li>
    
        <li class="nav-item">
            <a href="#tab-3-Postgres" aria-controls="tab-3-Postgres" role="tab" data-toggle="tab" data-lang="sql">Postgres</a>
        </li>
    
        </ul>
    
        <div class="tab-content">
            
        <div role="tabpanel" class="tab-pane active" id="tab-3-Haskell">
            <div class="codehilite"><pre><span></span><span class="c1">-- Only return results for genres whose total track length is over 5 minutes</span>
<span class="nf">filter_</span> <span class="p">(</span><span class="nf">\</span><span class="p">(</span><span class="n">genre</span><span class="p">,</span> <span class="n">distinctPriceCount</span><span class="p">,</span> <span class="n">totalTrackLength</span><span class="p">)</span> <span class="ow">-&gt;</span> <span class="n">totalTrackLength</span> <span class="o">&gt;=.</span> <span class="mi">300000</span><span class="p">)</span> <span class="o">$</span>
<span class="nf">aggregate_</span> <span class="p">(</span><span class="nf">\</span><span class="p">(</span><span class="n">genre</span><span class="p">,</span> <span class="n">track</span><span class="p">)</span> <span class="ow">-&gt;</span>
              <span class="p">(</span> <span class="n">group_</span> <span class="n">genre</span>
              <span class="p">,</span> <span class="n">as_</span> <span class="o">@</span><span class="kt">Int</span> <span class="o">$</span> <span class="n">countOver_</span> <span class="n">distinctInGroup_</span> <span class="p">(</span><span class="n">trackUnitPrice</span> <span class="n">track</span><span class="p">)</span>
              <span class="p">,</span> <span class="n">fromMaybe_</span> <span class="mi">0</span> <span class="p">(</span><span class="n">sumOver_</span> <span class="n">allInGroupExplicitly_</span> <span class="p">(</span><span class="n">trackMilliseconds</span> <span class="n">track</span><span class="p">))</span> <span class="p">`</span><span class="n">div_</span><span class="p">`</span> <span class="mi">1000</span> <span class="p">))</span> <span class="o">$</span>
           <span class="p">((,)</span> <span class="o">&lt;$&gt;</span> <span class="n">all_</span> <span class="p">(</span><span class="n">genre</span> <span class="n">chinookDb</span><span class="p">)</span> <span class="o">&lt;*&gt;</span> <span class="n">all_</span> <span class="p">(</span><span class="n">track</span> <span class="n">chinookDb</span><span class="p">))</span>
</pre></div>

        </div>
    
        <div role="tabpanel" class="tab-pane " id="tab-3-Sqlite">
            <div class="codehilite"><pre><span></span><span class="k">SELECT</span> <span class="ss">&quot;t0&quot;</span><span class="p">.</span><span class="ss">&quot;GenreId&quot;</span> <span class="k">AS</span> <span class="ss">&quot;res0&quot;</span><span class="p">,</span>
       <span class="ss">&quot;t0&quot;</span><span class="p">.</span><span class="ss">&quot;Name&quot;</span> <span class="k">AS</span> <span class="ss">&quot;res1&quot;</span><span class="p">,</span>
       <span class="k">COUNT</span><span class="p">(</span><span class="k">DISTINCT</span> <span class="ss">&quot;t1&quot;</span><span class="p">.</span><span class="ss">&quot;UnitPrice&quot;</span><span class="p">)</span> <span class="k">AS</span> <span class="ss">&quot;res2&quot;</span><span class="p">,</span>
       <span class="p">(</span><span class="n">COALESCE</span><span class="p">(</span><span class="k">SUM</span><span class="p">(</span><span class="k">ALL</span> <span class="ss">&quot;t1&quot;</span><span class="p">.</span><span class="ss">&quot;Milliseconds&quot;</span><span class="p">),</span> <span class="o">?</span><span class="p">))</span> <span class="o">/</span> <span class="p">(</span><span class="o">?</span><span class="p">)</span> <span class="k">AS</span> <span class="ss">&quot;res3&quot;</span>
<span class="k">FROM</span> <span class="ss">&quot;Genre&quot;</span> <span class="k">AS</span> <span class="ss">&quot;t0&quot;</span>
<span class="k">INNER</span> <span class="k">JOIN</span> <span class="ss">&quot;Track&quot;</span> <span class="k">AS</span> <span class="ss">&quot;t1&quot;</span>
<span class="k">GROUP</span> <span class="k">BY</span> <span class="ss">&quot;t0&quot;</span><span class="p">.</span><span class="ss">&quot;GenreId&quot;</span><span class="p">,</span>
         <span class="ss">&quot;t0&quot;</span><span class="p">.</span><span class="ss">&quot;Name&quot;</span>
<span class="k">HAVING</span> <span class="p">((</span><span class="n">COALESCE</span><span class="p">(</span><span class="k">SUM</span><span class="p">(</span><span class="k">ALL</span> <span class="ss">&quot;t1&quot;</span><span class="p">.</span><span class="ss">&quot;Milliseconds&quot;</span><span class="p">),</span> <span class="o">?</span><span class="p">))</span> <span class="o">/</span> <span class="p">(</span><span class="o">?</span><span class="p">))</span><span class="o">&gt;=</span><span class="p">(</span><span class="o">?</span><span class="p">);</span>

<span class="c1">-- With values: [SQLInteger 0,SQLInteger 1000,SQLInteger 0,SQLInteger 1000,SQLInteger 300000]</span>
</pre></div>

        </div>
    
        <div role="tabpanel" class="tab-pane " id="tab-3-Postgres">
            <div class="codehilite"><pre><span></span><span class="k">SELECT</span> <span class="ss">&quot;t0&quot;</span><span class="p">.</span><span class="ss">&quot;GenreId&quot;</span> <span class="k">AS</span> <span class="ss">&quot;res0&quot;</span><span class="p">,</span>
       <span class="ss">&quot;t0&quot;</span><span class="p">.</span><span class="ss">&quot;Name&quot;</span> <span class="k">AS</span> <span class="ss">&quot;res1&quot;</span><span class="p">,</span>
       <span class="k">COUNT</span><span class="p">(</span><span class="k">DISTINCT</span> <span class="ss">&quot;t1&quot;</span><span class="p">.</span><span class="ss">&quot;UnitPrice&quot;</span><span class="p">)</span> <span class="k">AS</span> <span class="ss">&quot;res2&quot;</span><span class="p">,</span>
       <span class="p">(</span><span class="n">COALESCE</span><span class="p">(</span><span class="k">SUM</span><span class="p">(</span><span class="k">ALL</span> <span class="ss">&quot;t1&quot;</span><span class="p">.</span><span class="ss">&quot;Milliseconds&quot;</span><span class="p">),</span> <span class="mi">0</span><span class="p">))</span> <span class="o">/</span> <span class="p">(</span><span class="mi">1000</span><span class="p">)</span> <span class="k">AS</span> <span class="ss">&quot;res3&quot;</span>
<span class="k">FROM</span> <span class="ss">&quot;Genre&quot;</span> <span class="k">AS</span> <span class="ss">&quot;t0&quot;</span>
<span class="k">CROSS</span> <span class="k">JOIN</span> <span class="ss">&quot;Track&quot;</span> <span class="k">AS</span> <span class="ss">&quot;t1&quot;</span>
<span class="k">GROUP</span> <span class="k">BY</span> <span class="ss">&quot;t0&quot;</span><span class="p">.</span><span class="ss">&quot;GenreId&quot;</span><span class="p">,</span>
         <span class="ss">&quot;t0&quot;</span><span class="p">.</span><span class="ss">&quot;Name&quot;</span>
<span class="k">HAVING</span> <span class="p">((</span><span class="n">COALESCE</span><span class="p">(</span><span class="k">SUM</span><span class="p">(</span><span class="k">ALL</span> <span class="ss">&quot;t1&quot;</span><span class="p">.</span><span class="ss">&quot;Milliseconds&quot;</span><span class="p">),</span> <span class="mi">0</span><span class="p">))</span> <span class="o">/</span> <span class="p">(</span><span class="mi">1000</span><span class="p">))</span> <span class="o">&gt;=</span> <span class="p">(</span><span class="mi">300000</span><span class="p">)</span>
</pre></div>

        </div>
    
        </div>
    
                </div>
                    </p>
<p>Beam will also handle the <code>filter_</code> correctly in the presence of more
complicated queries. For example, we can now join our aggregate on genres back
over tracks.</p>
<p>
                <div class="code-nav-container">
                    
        <ul class="nav nav-tabs">
            
        <li class="nav-item">
            <a href="#tab-4-Haskell" aria-controls="tab-4-Haskell" role="tab" data-toggle="tab" data-lang="haskell">Haskell</a>
        </li>
    
        <li class="nav-item">
            <a href="#tab-4-Sqlite" aria-controls="tab-4-Sqlite" role="tab" data-toggle="tab" data-lang="sql">Sqlite</a>
        </li>
    
        <li class="nav-item">
            <a href="#tab-4-Postgres" aria-controls="tab-4-Postgres" role="tab" data-toggle="tab" data-lang="sql">Postgres</a>
        </li>
    
        </ul>
    
        <div class="tab-content">
            
        <div role="tabpanel" class="tab-pane active" id="tab-4-Haskell">
            <div class="codehilite"><pre><span></span><span class="c1">-- Only return results for genres whose total track length is over 5 minutes</span>
<span class="nf">filter_</span> <span class="p">(</span><span class="nf">\</span><span class="p">(</span><span class="n">genre</span><span class="p">,</span> <span class="n">track</span><span class="p">,</span> <span class="n">distinctPriceCount</span><span class="p">,</span> <span class="n">totalTrackLength</span><span class="p">)</span> <span class="ow">-&gt;</span> <span class="n">totalTrackLength</span> <span class="o">&gt;=.</span> <span class="mi">300000</span><span class="p">)</span> <span class="o">$</span>
<span class="kr">do</span> <span class="p">(</span><span class="n">genre</span><span class="p">,</span> <span class="n">priceCnt</span><span class="p">,</span> <span class="n">trackLength</span><span class="p">)</span> <span class="ow">&lt;-</span>
            <span class="n">aggregate_</span> <span class="p">(</span><span class="nf">\</span><span class="p">(</span><span class="n">genre</span><span class="p">,</span> <span class="n">track</span><span class="p">)</span> <span class="ow">-&gt;</span>
                          <span class="p">(</span> <span class="n">group_</span> <span class="n">genre</span>
                          <span class="p">,</span> <span class="n">as_</span> <span class="o">@</span><span class="kt">Int</span> <span class="o">$</span> <span class="n">countOver_</span> <span class="n">distinctInGroup_</span> <span class="p">(</span><span class="n">trackUnitPrice</span> <span class="n">track</span><span class="p">)</span>
                          <span class="p">,</span> <span class="n">fromMaybe_</span> <span class="mi">0</span> <span class="p">(</span><span class="n">sumOver_</span> <span class="n">allInGroupExplicitly_</span> <span class="p">(</span><span class="n">trackMilliseconds</span> <span class="n">track</span><span class="p">))</span> <span class="p">`</span><span class="n">div_</span><span class="p">`</span> <span class="mi">1000</span> <span class="p">))</span> <span class="o">$</span>
            <span class="p">((,)</span> <span class="o">&lt;$&gt;</span> <span class="n">all_</span> <span class="p">(</span><span class="n">genre</span> <span class="n">chinookDb</span><span class="p">)</span> <span class="o">&lt;*&gt;</span> <span class="n">all_</span> <span class="p">(</span><span class="n">track</span> <span class="n">chinookDb</span><span class="p">))</span>
   <span class="n">track</span> <span class="ow">&lt;-</span> <span class="n">join_</span> <span class="p">(</span><span class="n">track</span> <span class="n">chinookDb</span><span class="p">)</span> <span class="p">(</span><span class="nf">\</span><span class="n">track</span> <span class="ow">-&gt;</span> <span class="n">trackGenreId</span> <span class="n">track</span> <span class="o">==.</span> <span class="n">just_</span> <span class="p">(</span><span class="n">pk</span> <span class="n">genre</span><span class="p">))</span>
   <span class="n">pure</span> <span class="p">(</span><span class="n">genre</span><span class="p">,</span> <span class="n">track</span><span class="p">,</span> <span class="n">priceCnt</span><span class="p">,</span> <span class="n">trackLength</span><span class="p">)</span>
</pre></div>

        </div>
    
        <div role="tabpanel" class="tab-pane " id="tab-4-Sqlite">
            <div class="codehilite"><pre><span></span><span class="k">SELECT</span> <span class="ss">&quot;t0&quot;</span><span class="p">.</span><span class="ss">&quot;res0&quot;</span> <span class="k">AS</span> <span class="ss">&quot;res0&quot;</span><span class="p">,</span>
       <span class="ss">&quot;t0&quot;</span><span class="p">.</span><span class="ss">&quot;res1&quot;</span> <span class="k">AS</span> <span class="ss">&quot;res1&quot;</span><span class="p">,</span>
       <span class="ss">&quot;t1&quot;</span><span class="p">.</span><span class="ss">&quot;TrackId&quot;</span> <span class="k">AS</span> <span class="ss">&quot;res2&quot;</span><span class="p">,</span>
       <span class="ss">&quot;t1&quot;</span><span class="p">.</span><span class="ss">&quot;Name&quot;</span> <span class="k">AS</span> <span class="ss">&quot;res3&quot;</span><span class="p">,</span>
       <span class="ss">&quot;t1&quot;</span><span class="p">.</span><span class="ss">&quot;AlbumId&quot;</span> <span class="k">AS</span> <span class="ss">&quot;res4&quot;</span><span class="p">,</span>
       <span class="ss">&quot;t1&quot;</span><span class="p">.</span><span class="ss">&quot;MediaTypeId&quot;</span> <span class="k">AS</span> <span class="ss">&quot;res5&quot;</span><span class="p">,</span>
       <span class="ss">&quot;t1&quot;</span><span class="p">.</span><span class="ss">&quot;GenreId&quot;</span> <span class="k">AS</span> <span class="ss">&quot;res6&quot;</span><span class="p">,</span>
       <span class="ss">&quot;t1&quot;</span><span class="p">.</span><span class="ss">&quot;Composer&quot;</span> <span class="k">AS</span> <span class="ss">&quot;res7&quot;</span><span class="p">,</span>
       <span class="ss">&quot;t1&quot;</span><span class="p">.</span><span class="ss">&quot;Milliseconds&quot;</span> <span class="k">AS</span> <span class="ss">&quot;res8&quot;</span><span class="p">,</span>
       <span class="ss">&quot;t1&quot;</span><span class="p">.</span><span class="ss">&quot;Bytes&quot;</span> <span class="k">AS</span> <span class="ss">&quot;res9&quot;</span><span class="p">,</span>
       <span class="ss">&quot;t1&quot;</span><span class="p">.</span><span class="ss">&quot;UnitPrice&quot;</span> <span class="k">AS</span> <span class="ss">&quot;res10&quot;</span><span class="p">,</span>
       <span class="ss">&quot;t0&quot;</span><span class="p">.</span><span class="ss">&quot;res2&quot;</span> <span class="k">AS</span> <span class="ss">&quot;res11&quot;</span><span class="p">,</span>
       <span class="ss">&quot;t0&quot;</span><span class="p">.</span><span class="ss">&quot;res3&quot;</span> <span class="k">AS</span> <span class="ss">&quot;res12&quot;</span>
<span class="k">FROM</span>
  <span class="p">(</span><span class="k">SELECT</span> <span class="ss">&quot;t0&quot;</span><span class="p">.</span><span class="ss">&quot;GenreId&quot;</span> <span class="k">AS</span> <span class="ss">&quot;res0&quot;</span><span class="p">,</span>
          <span class="ss">&quot;t0&quot;</span><span class="p">.</span><span class="ss">&quot;Name&quot;</span> <span class="k">AS</span> <span class="ss">&quot;res1&quot;</span><span class="p">,</span>
          <span class="k">COUNT</span><span class="p">(</span><span class="k">DISTINCT</span> <span class="ss">&quot;t1&quot;</span><span class="p">.</span><span class="ss">&quot;UnitPrice&quot;</span><span class="p">)</span> <span class="k">AS</span> <span class="ss">&quot;res2&quot;</span><span class="p">,</span>
          <span class="p">(</span><span class="n">COALESCE</span><span class="p">(</span><span class="k">SUM</span><span class="p">(</span><span class="k">ALL</span> <span class="ss">&quot;t1&quot;</span><span class="p">.</span><span class="ss">&quot;Milliseconds&quot;</span><span class="p">),</span> <span class="o">?</span><span class="p">))</span> <span class="o">/</span> <span class="p">(</span><span class="o">?</span><span class="p">)</span> <span class="k">AS</span> <span class="ss">&quot;res3&quot;</span>
   <span class="k">FROM</span> <span class="ss">&quot;Genre&quot;</span> <span class="k">AS</span> <span class="ss">&quot;t0&quot;</span>
   <span class="k">INNER</span> <span class="k">JOIN</span> <span class="ss">&quot;Track&quot;</span> <span class="k">AS</span> <span class="ss">&quot;t1&quot;</span>
   <span class="k">GROUP</span> <span class="k">BY</span> <span class="ss">&quot;t0&quot;</span><span class="p">.</span><span class="ss">&quot;GenreId&quot;</span><span class="p">,</span>
            <span class="ss">&quot;t0&quot;</span><span class="p">.</span><span class="ss">&quot;Name&quot;</span><span class="p">)</span> <span class="k">AS</span> <span class="ss">&quot;t0&quot;</span>
<span class="k">INNER</span> <span class="k">JOIN</span> <span class="ss">&quot;Track&quot;</span> <span class="k">AS</span> <span class="ss">&quot;t1&quot;</span> <span class="k">ON</span> <span class="k">CASE</span>
                                  <span class="k">WHEN</span> <span class="p">((</span><span class="ss">&quot;t1&quot;</span><span class="p">.</span><span class="ss">&quot;GenreId&quot;</span><span class="p">)</span> <span class="k">IS</span> <span class="k">NULL</span><span class="p">)</span>
                                       <span class="k">AND</span> <span class="p">((</span><span class="ss">&quot;t0&quot;</span><span class="p">.</span><span class="ss">&quot;res0&quot;</span><span class="p">)</span> <span class="k">IS</span> <span class="k">NULL</span><span class="p">)</span> <span class="k">THEN</span> <span class="o">?</span>
                                  <span class="k">WHEN</span> <span class="p">((</span><span class="ss">&quot;t1&quot;</span><span class="p">.</span><span class="ss">&quot;GenreId&quot;</span><span class="p">)</span> <span class="k">IS</span> <span class="k">NULL</span><span class="p">)</span>
                                       <span class="k">OR</span> <span class="p">((</span><span class="ss">&quot;t0&quot;</span><span class="p">.</span><span class="ss">&quot;res0&quot;</span><span class="p">)</span> <span class="k">IS</span> <span class="k">NULL</span><span class="p">)</span> <span class="k">THEN</span> <span class="o">?</span>
                                  <span class="k">ELSE</span> <span class="p">(</span><span class="ss">&quot;t1&quot;</span><span class="p">.</span><span class="ss">&quot;GenreId&quot;</span><span class="p">)</span><span class="o">=</span><span class="p">(</span><span class="ss">&quot;t0&quot;</span><span class="p">.</span><span class="ss">&quot;res0&quot;</span><span class="p">)</span>
                              <span class="k">END</span>
<span class="k">WHERE</span> <span class="p">(</span><span class="ss">&quot;t0&quot;</span><span class="p">.</span><span class="ss">&quot;res3&quot;</span><span class="p">)</span><span class="o">&gt;=</span><span class="p">(</span><span class="o">?</span><span class="p">);</span>

<span class="c1">-- With values: [SQLInteger 0,SQLInteger 1000,SQLInteger 1,SQLInteger 0,SQLInteger 300000]</span>
</pre></div>

        </div>
    
        <div role="tabpanel" class="tab-pane " id="tab-4-Postgres">
            <div class="codehilite"><pre><span></span><span class="k">SELECT</span> <span class="ss">&quot;t0&quot;</span><span class="p">.</span><span class="ss">&quot;res0&quot;</span> <span class="k">AS</span> <span class="ss">&quot;res0&quot;</span><span class="p">,</span>
       <span class="ss">&quot;t0&quot;</span><span class="p">.</span><span class="ss">&quot;res1&quot;</span> <span class="k">AS</span> <span class="ss">&quot;res1&quot;</span><span class="p">,</span>
       <span class="ss">&quot;t1&quot;</span><span class="p">.</span><span class="ss">&quot;TrackId&quot;</span> <span class="k">AS</span> <span class="ss">&quot;res2&quot;</span><span class="p">,</span>
       <span class="ss">&quot;t1&quot;</span><span class="p">.</span><span class="ss">&quot;Name&quot;</span> <span class="k">AS</span> <span class="ss">&quot;res3&quot;</span><span class="p">,</span>
       <span class="ss">&quot;t1&quot;</span><span class="p">.</span><span class="ss">&quot;AlbumId&quot;</span> <span class="k">AS</span> <span class="ss">&quot;res4&quot;</span><span class="p">,</span>
       <span class="ss">&quot;t1&quot;</span><span class="p">.</span><span class="ss">&quot;MediaTypeId&quot;</span> <span class="k">AS</span> <span class="ss">&quot;res5&quot;</span><span class="p">,</span>
       <span class="ss">&quot;t1&quot;</span><span class="p">.</span><span class="ss">&quot;GenreId&quot;</span> <span class="k">AS</span> <span class="ss">&quot;res6&quot;</span><span class="p">,</span>
       <span class="ss">&quot;t1&quot;</span><span class="p">.</span><span class="ss">&quot;Composer&quot;</span> <span class="k">AS</span> <span class="ss">&quot;res7&quot;</span><span class="p">,</span>
       <span class="ss">&quot;t1&quot;</span><span class="p">.</span><span class="ss">&quot;Milliseconds&quot;</span> <span class="k">AS</span> <span class="ss">&quot;res8&quot;</span><span class="p">,</span>
       <span class="ss">&quot;t1&quot;</span><span class="p">.</span><span class="ss">&quot;Bytes&quot;</span> <span class="k">AS</span> <span class="ss">&quot;res9&quot;</span><span class="p">,</span>
       <span class="ss">&quot;t1&quot;</span><span class="p">.</span><span class="ss">&quot;UnitPrice&quot;</span> <span class="k">AS</span> <span class="ss">&quot;res10&quot;</span><span class="p">,</span>
       <span class="ss">&quot;t0&quot;</span><span class="p">.</span><span class="ss">&quot;res2&quot;</span> <span class="k">AS</span> <span class="ss">&quot;res11&quot;</span><span class="p">,</span>
       <span class="ss">&quot;t0&quot;</span><span class="p">.</span><span class="ss">&quot;res3&quot;</span> <span class="k">AS</span> <span class="ss">&quot;res12&quot;</span>
<span class="k">FROM</span>
  <span class="p">(</span><span class="k">SELECT</span> <span class="ss">&quot;t0&quot;</span><span class="p">.</span><span class="ss">&quot;GenreId&quot;</span> <span class="k">AS</span> <span class="ss">&quot;res0&quot;</span><span class="p">,</span>
          <span class="ss">&quot;t0&quot;</span><span class="p">.</span><span class="ss">&quot;Name&quot;</span> <span class="k">AS</span> <span class="ss">&quot;res1&quot;</span><span class="p">,</span>
          <span class="k">COUNT</span><span class="p">(</span><span class="k">DISTINCT</span> <span class="ss">&quot;t1&quot;</span><span class="p">.</span><span class="ss">&quot;UnitPrice&quot;</span><span class="p">)</span> <span class="k">AS</span> <span class="ss">&quot;res2&quot;</span><span class="p">,</span>
          <span class="p">(</span><span class="n">COALESCE</span><span class="p">(</span><span class="k">SUM</span><span class="p">(</span><span class="k">ALL</span> <span class="ss">&quot;t1&quot;</span><span class="p">.</span><span class="ss">&quot;Milliseconds&quot;</span><span class="p">),</span> <span class="mi">0</span><span class="p">))</span> <span class="o">/</span> <span class="p">(</span><span class="mi">1000</span><span class="p">)</span> <span class="k">AS</span> <span class="ss">&quot;res3&quot;</span>
   <span class="k">FROM</span> <span class="ss">&quot;Genre&quot;</span> <span class="k">AS</span> <span class="ss">&quot;t0&quot;</span>
   <span class="k">CROSS</span> <span class="k">JOIN</span> <span class="ss">&quot;Track&quot;</span> <span class="k">AS</span> <span class="ss">&quot;t1&quot;</span>
   <span class="k">GROUP</span> <span class="k">BY</span> <span class="ss">&quot;t0&quot;</span><span class="p">.</span><span class="ss">&quot;GenreId&quot;</span><span class="p">,</span>
            <span class="ss">&quot;t0&quot;</span><span class="p">.</span><span class="ss">&quot;Name&quot;</span><span class="p">)</span> <span class="k">AS</span> <span class="ss">&quot;t0&quot;</span>
<span class="k">INNER</span> <span class="k">JOIN</span> <span class="ss">&quot;Track&quot;</span> <span class="k">AS</span> <span class="ss">&quot;t1&quot;</span> <span class="k">ON</span> <span class="p">(</span><span class="ss">&quot;t1&quot;</span><span class="p">.</span><span class="ss">&quot;GenreId&quot;</span><span class="p">)</span> <span class="k">IS</span> <span class="k">NOT</span> <span class="k">DISTINCT</span>
<span class="k">FROM</span> <span class="p">(</span><span class="ss">&quot;t0&quot;</span><span class="p">.</span><span class="ss">&quot;res0&quot;</span><span class="p">)</span>
<span class="k">WHERE</span> <span class="p">(</span><span class="ss">&quot;t0&quot;</span><span class="p">.</span><span class="ss">&quot;res3&quot;</span><span class="p">)</span> <span class="o">&gt;=</span> <span class="p">(</span><span class="mi">300000</span><span class="p">)</span>
</pre></div>

        </div>
    
        </div>
    
                </div>
                    </p>
<p>The position of <code>filter_</code> changes the code generated. Above, the <code>filter_</code>
produced a <code>WHERE</code> clause on the outermost <code>SELECT</code>. If instead, we put the
<code>filter_</code> clause right outside the <code>aggregate_</code>, beam will produce a <code>HAVING</code> clause instead.</p>
<p>
                <div class="code-nav-container">
                    
        <ul class="nav nav-tabs">
            
        <li class="nav-item">
            <a href="#tab-5-Haskell" aria-controls="tab-5-Haskell" role="tab" data-toggle="tab" data-lang="haskell">Haskell</a>
        </li>
    
        <li class="nav-item">
            <a href="#tab-5-Sqlite" aria-controls="tab-5-Sqlite" role="tab" data-toggle="tab" data-lang="sql">Sqlite</a>
        </li>
    
        <li class="nav-item">
            <a href="#tab-5-Postgres" aria-controls="tab-5-Postgres" role="tab" data-toggle="tab" data-lang="sql">Postgres</a>
        </li>
    
        </ul>
    
        <div class="tab-content">
            
        <div role="tabpanel" class="tab-pane active" id="tab-5-Haskell">
            <div class="codehilite"><pre><span></span><span class="c1">-- Only return results for genres whose total track length is over 5 minutes</span>
<span class="kr">do</span> <span class="p">(</span><span class="n">genre</span><span class="p">,</span> <span class="n">priceCnt</span><span class="p">,</span> <span class="n">trackLength</span><span class="p">)</span> <span class="ow">&lt;-</span>
            <span class="n">filter_</span> <span class="p">(</span><span class="nf">\</span><span class="p">(</span><span class="n">genre</span><span class="p">,</span> <span class="n">distinctPriceCount</span><span class="p">,</span> <span class="n">totalTrackLength</span><span class="p">)</span> <span class="ow">-&gt;</span> <span class="n">totalTrackLength</span> <span class="o">&gt;=.</span> <span class="mi">300000</span><span class="p">)</span> <span class="o">$</span>
            <span class="n">aggregate_</span> <span class="p">(</span><span class="nf">\</span><span class="p">(</span><span class="n">genre</span><span class="p">,</span> <span class="n">track</span><span class="p">)</span> <span class="ow">-&gt;</span>
                          <span class="p">(</span> <span class="n">group_</span> <span class="n">genre</span>
                          <span class="p">,</span> <span class="n">as_</span> <span class="o">@</span><span class="kt">Int</span> <span class="o">$</span> <span class="n">countOver_</span> <span class="n">distinctInGroup_</span> <span class="p">(</span><span class="n">trackUnitPrice</span> <span class="n">track</span><span class="p">)</span>
                          <span class="p">,</span> <span class="n">fromMaybe_</span> <span class="mi">0</span> <span class="p">(</span><span class="n">sumOver_</span> <span class="n">allInGroupExplicitly_</span> <span class="p">(</span><span class="n">trackMilliseconds</span> <span class="n">track</span><span class="p">))</span> <span class="p">`</span><span class="n">div_</span><span class="p">`</span> <span class="mi">1000</span> <span class="p">))</span> <span class="o">$</span>
            <span class="p">((,)</span> <span class="o">&lt;$&gt;</span> <span class="n">all_</span> <span class="p">(</span><span class="n">genre</span> <span class="n">chinookDb</span><span class="p">)</span> <span class="o">&lt;*&gt;</span> <span class="n">all_</span> <span class="p">(</span><span class="n">track</span> <span class="n">chinookDb</span><span class="p">))</span>
   <span class="n">track</span> <span class="ow">&lt;-</span> <span class="n">join_</span> <span class="p">(</span><span class="n">track</span> <span class="n">chinookDb</span><span class="p">)</span> <span class="p">(</span><span class="nf">\</span><span class="n">track</span> <span class="ow">-&gt;</span> <span class="n">trackGenreId</span> <span class="n">track</span> <span class="o">==.</span> <span class="n">just_</span> <span class="p">(</span><span class="n">pk</span> <span class="n">genre</span><span class="p">))</span>
   <span class="n">pure</span> <span class="p">(</span><span class="n">genre</span><span class="p">,</span> <span class="n">track</span><span class="p">,</span> <span class="n">priceCnt</span><span class="p">,</span> <span class="n">trackLength</span><span class="p">)</span>
</pre></div>

        </div>
    
        <div role="tabpanel" class="tab-pane " id="tab-5-Sqlite">
            <div class="codehilite"><pre><span></span><span class="k">SELECT</span> <span class="ss">&quot;t0&quot;</span><span class="p">.</span><span class="ss">&quot;res0&quot;</span> <span class="k">AS</span> <span class="ss">&quot;res0&quot;</span><span class="p">,</span>
       <span class="ss">&quot;t0&quot;</span><span class="p">.</span><span class="ss">&quot;res1&quot;</span> <span class="k">AS</span> <span class="ss">&quot;res1&quot;</span><span class="p">,</span>
       <span class="ss">&quot;t1&quot;</span><span class="p">.</span><span class="ss">&quot;TrackId&quot;</span> <span class="k">AS</span> <span class="ss">&quot;res2&quot;</span><span class="p">,</span>
       <span class="ss">&quot;t1&quot;</span><span class="p">.</span><span class="ss">&quot;Name&quot;</span> <span class="k">AS</span> <span class="ss">&quot;res3&quot;</span><span class="p">,</span>
       <span class="ss">&quot;t1&quot;</span><span class="p">.</span><span class="ss">&quot;AlbumId&quot;</span> <span class="k">AS</span> <span class="ss">&quot;res4&quot;</span><span class="p">,</span>
       <span class="ss">&quot;t1&quot;</span><span class="p">.</span><span class="ss">&quot;MediaTypeId&quot;</span> <span class="k">AS</span> <span class="ss">&quot;res5&quot;</span><span class="p">,</span>
       <span class="ss">&quot;t1&quot;</span><span class="p">.</span><span class="ss">&quot;GenreId&quot;</span> <span class="k">AS</span> <span class="ss">&quot;res6&quot;</span><span class="p">,</span>
       <span class="ss">&quot;t1&quot;</span><span class="p">.</span><span class="ss">&quot;Composer&quot;</span> <span class="k">AS</span> <span class="ss">&quot;res7&quot;</span><span class="p">,</span>
       <span class="ss">&quot;t1&quot;</span><span class="p">.</span><span class="ss">&quot;Milliseconds&quot;</span> <span class="k">AS</span> <span class="ss">&quot;res8&quot;</span><span class="p">,</span>
       <span class="ss">&quot;t1&quot;</span><span class="p">.</span><span class="ss">&quot;Bytes&quot;</span> <span class="k">AS</span> <span class="ss">&quot;res9&quot;</span><span class="p">,</span>
       <span class="ss">&quot;t1&quot;</span><span class="p">.</span><span class="ss">&quot;UnitPrice&quot;</span> <span class="k">AS</span> <span class="ss">&quot;res10&quot;</span><span class="p">,</span>
       <span class="ss">&quot;t0&quot;</span><span class="p">.</span><span class="ss">&quot;res2&quot;</span> <span class="k">AS</span> <span class="ss">&quot;res11&quot;</span><span class="p">,</span>
       <span class="ss">&quot;t0&quot;</span><span class="p">.</span><span class="ss">&quot;res3&quot;</span> <span class="k">AS</span> <span class="ss">&quot;res12&quot;</span>
<span class="k">FROM</span>
  <span class="p">(</span><span class="k">SELECT</span> <span class="ss">&quot;t0&quot;</span><span class="p">.</span><span class="ss">&quot;GenreId&quot;</span> <span class="k">AS</span> <span class="ss">&quot;res0&quot;</span><span class="p">,</span>
          <span class="ss">&quot;t0&quot;</span><span class="p">.</span><span class="ss">&quot;Name&quot;</span> <span class="k">AS</span> <span class="ss">&quot;res1&quot;</span><span class="p">,</span>
          <span class="k">COUNT</span><span class="p">(</span><span class="k">DISTINCT</span> <span class="ss">&quot;t1&quot;</span><span class="p">.</span><span class="ss">&quot;UnitPrice&quot;</span><span class="p">)</span> <span class="k">AS</span> <span class="ss">&quot;res2&quot;</span><span class="p">,</span>
          <span class="p">(</span><span class="n">COALESCE</span><span class="p">(</span><span class="k">SUM</span><span class="p">(</span><span class="k">ALL</span> <span class="ss">&quot;t1&quot;</span><span class="p">.</span><span class="ss">&quot;Milliseconds&quot;</span><span class="p">),</span> <span class="o">?</span><span class="p">))</span> <span class="o">/</span> <span class="p">(</span><span class="o">?</span><span class="p">)</span> <span class="k">AS</span> <span class="ss">&quot;res3&quot;</span>
   <span class="k">FROM</span> <span class="ss">&quot;Genre&quot;</span> <span class="k">AS</span> <span class="ss">&quot;t0&quot;</span>
   <span class="k">INNER</span> <span class="k">JOIN</span> <span class="ss">&quot;Track&quot;</span> <span class="k">AS</span> <span class="ss">&quot;t1&quot;</span>
   <span class="k">GROUP</span> <span class="k">BY</span> <span class="ss">&quot;t0&quot;</span><span class="p">.</span><span class="ss">&quot;GenreId&quot;</span><span class="p">,</span>
            <span class="ss">&quot;t0&quot;</span><span class="p">.</span><span class="ss">&quot;Name&quot;</span>
   <span class="k">HAVING</span> <span class="p">((</span><span class="n">COALESCE</span><span class="p">(</span><span class="k">SUM</span><span class="p">(</span><span class="k">ALL</span> <span class="ss">&quot;t1&quot;</span><span class="p">.</span><span class="ss">&quot;Milliseconds&quot;</span><span class="p">),</span> <span class="o">?</span><span class="p">))</span> <span class="o">/</span> <span class="p">(</span><span class="o">?</span><span class="p">))</span><span class="o">&gt;=</span><span class="p">(</span><span class="o">?</span><span class="p">))</span> <span class="k">AS</span> <span class="ss">&quot;t0&quot;</span>
<span class="k">INNER</span> <span class="k">JOIN</span> <span class="ss">&quot;Track&quot;</span> <span class="k">AS</span> <span class="ss">&quot;t1&quot;</span> <span class="k">ON</span> <span class="k">CASE</span>
                                  <span class="k">WHEN</span> <span class="p">((</span><span class="ss">&quot;t1&quot;</span><span class="p">.</span><span class="ss">&quot;GenreId&quot;</span><span class="p">)</span> <span class="k">IS</span> <span class="k">NULL</span><span class="p">)</span>
                                       <span class="k">AND</span> <span class="p">((</span><span class="ss">&quot;t0&quot;</span><span class="p">.</span><span class="ss">&quot;res0&quot;</span><span class="p">)</span> <span class="k">IS</span> <span class="k">NULL</span><span class="p">)</span> <span class="k">THEN</span> <span class="o">?</span>
                                  <span class="k">WHEN</span> <span class="p">((</span><span class="ss">&quot;t1&quot;</span><span class="p">.</span><span class="ss">&quot;GenreId&quot;</span><span class="p">)</span> <span class="k">IS</span> <span class="k">NULL</span><span class="p">)</span>
                                       <span class="k">OR</span> <span class="p">((</span><span class="ss">&quot;t0&quot;</span><span class="p">.</span><span class="ss">&quot;res0&quot;</span><span class="p">)</span> <span class="k">IS</span> <span class="k">NULL</span><span class="p">)</span> <span class="k">THEN</span> <span class="o">?</span>
                                  <span class="k">ELSE</span> <span class="p">(</span><span class="ss">&quot;t1&quot;</span><span class="p">.</span><span class="ss">&quot;GenreId&quot;</span><span class="p">)</span><span class="o">=</span><span class="p">(</span><span class="ss">&quot;t0&quot;</span><span class="p">.</span><span class="ss">&quot;res0&quot;</span><span class="p">)</span>
                              <span class="k">END</span><span class="p">;</span>

<span class="c1">-- With values: [SQLInteger 0,SQLInteger 1000,SQLInteger 0,SQLInteger 1000,SQLInteger 300000,SQLInteger 1,SQLInteger 0]</span>
</pre></div>

        </div>
    
        <div role="tabpanel" class="tab-pane " id="tab-5-Postgres">
            <div class="codehilite"><pre><span></span><span class="k">SELECT</span> <span class="ss">&quot;t0&quot;</span><span class="p">.</span><span class="ss">&quot;res0&quot;</span> <span class="k">AS</span> <span class="ss">&quot;res0&quot;</span><span class="p">,</span>
       <span class="ss">&quot;t0&quot;</span><span class="p">.</span><span class="ss">&quot;res1&quot;</span> <span class="k">AS</span> <span class="ss">&quot;res1&quot;</span><span class="p">,</span>
       <span class="ss">&quot;t1&quot;</span><span class="p">.</span><span class="ss">&quot;TrackId&quot;</span> <span class="k">AS</span> <span class="ss">&quot;res2&quot;</span><span class="p">,</span>
       <span class="ss">&quot;t1&quot;</span><span class="p">.</span><span class="ss">&quot;Name&quot;</span> <span class="k">AS</span> <span class="ss">&quot;res3&quot;</span><span class="p">,</span>
       <span class="ss">&quot;t1&quot;</span><span class="p">.</span><span class="ss">&quot;AlbumId&quot;</span> <span class="k">AS</span> <span class="ss">&quot;res4&quot;</span><span class="p">,</span>
       <span class="ss">&quot;t1&quot;</span><span class="p">.</span><span class="ss">&quot;MediaTypeId&quot;</span> <span class="k">AS</span> <span class="ss">&quot;res5&quot;</span><span class="p">,</span>
       <span class="ss">&quot;t1&quot;</span><span class="p">.</span><span class="ss">&quot;GenreId&quot;</span> <span class="k">AS</span> <span class="ss">&quot;res6&quot;</span><span class="p">,</span>
       <span class="ss">&quot;t1&quot;</span><span class="p">.</span><span class="ss">&quot;Composer&quot;</span> <span class="k">AS</span> <span class="ss">&quot;res7&quot;</span><span class="p">,</span>
       <span class="ss">&quot;t1&quot;</span><span class="p">.</span><span class="ss">&quot;Milliseconds&quot;</span> <span class="k">AS</span> <span class="ss">&quot;res8&quot;</span><span class="p">,</span>
       <span class="ss">&quot;t1&quot;</span><span class="p">.</span><span class="ss">&quot;Bytes&quot;</span> <span class="k">AS</span> <span class="ss">&quot;res9&quot;</span><span class="p">,</span>
       <span class="ss">&quot;t1&quot;</span><span class="p">.</span><span class="ss">&quot;UnitPrice&quot;</span> <span class="k">AS</span> <span class="ss">&quot;res10&quot;</span><span class="p">,</span>
       <span class="ss">&quot;t0&quot;</span><span class="p">.</span><span class="ss">&quot;res2&quot;</span> <span class="k">AS</span> <span class="ss">&quot;res11&quot;</span><span class="p">,</span>
       <span class="ss">&quot;t0&quot;</span><span class="p">.</span><span class="ss">&quot;res3&quot;</span> <span class="k">AS</span> <span class="ss">&quot;res12&quot;</span>
<span class="k">FROM</span>
  <span class="p">(</span><span class="k">SELECT</span> <span class="ss">&quot;t0&quot;</span><span class="p">.</span><span class="ss">&quot;GenreId&quot;</span> <span class="k">AS</span> <span class="ss">&quot;res0&quot;</span><span class="p">,</span>
          <span class="ss">&quot;t0&quot;</span><span class="p">.</span><span class="ss">&quot;Name&quot;</span> <span class="k">AS</span> <span class="ss">&quot;res1&quot;</span><span class="p">,</span>
          <span class="k">COUNT</span><span class="p">(</span><span class="k">DISTINCT</span> <span class="ss">&quot;t1&quot;</span><span class="p">.</span><span class="ss">&quot;UnitPrice&quot;</span><span class="p">)</span> <span class="k">AS</span> <span class="ss">&quot;res2&quot;</span><span class="p">,</span>
          <span class="p">(</span><span class="n">COALESCE</span><span class="p">(</span><span class="k">SUM</span><span class="p">(</span><span class="k">ALL</span> <span class="ss">&quot;t1&quot;</span><span class="p">.</span><span class="ss">&quot;Milliseconds&quot;</span><span class="p">),</span> <span class="mi">0</span><span class="p">))</span> <span class="o">/</span> <span class="p">(</span><span class="mi">1000</span><span class="p">)</span> <span class="k">AS</span> <span class="ss">&quot;res3&quot;</span>
   <span class="k">FROM</span> <span class="ss">&quot;Genre&quot;</span> <span class="k">AS</span> <span class="ss">&quot;t0&quot;</span>
   <span class="k">CROSS</span> <span class="k">JOIN</span> <span class="ss">&quot;Track&quot;</span> <span class="k">AS</span> <span class="ss">&quot;t1&quot;</span>
   <span class="k">GROUP</span> <span class="k">BY</span> <span class="ss">&quot;t0&quot;</span><span class="p">.</span><span class="ss">&quot;GenreId&quot;</span><span class="p">,</span>
            <span class="ss">&quot;t0&quot;</span><span class="p">.</span><span class="ss">&quot;Name&quot;</span>
   <span class="k">HAVING</span> <span class="p">((</span><span class="n">COALESCE</span><span class="p">(</span><span class="k">SUM</span><span class="p">(</span><span class="k">ALL</span> <span class="ss">&quot;t1&quot;</span><span class="p">.</span><span class="ss">&quot;Milliseconds&quot;</span><span class="p">),</span> <span class="mi">0</span><span class="p">))</span> <span class="o">/</span> <span class="p">(</span><span class="mi">1000</span><span class="p">))</span> <span class="o">&gt;=</span> <span class="p">(</span><span class="mi">300000</span><span class="p">))</span> <span class="k">AS</span> <span class="ss">&quot;t0&quot;</span>
<span class="k">INNER</span> <span class="k">JOIN</span> <span class="ss">&quot;Track&quot;</span> <span class="k">AS</span> <span class="ss">&quot;t1&quot;</span> <span class="k">ON</span> <span class="p">(</span><span class="ss">&quot;t1&quot;</span><span class="p">.</span><span class="ss">&quot;GenreId&quot;</span><span class="p">)</span> <span class="k">IS</span> <span class="k">NOT</span> <span class="k">DISTINCT</span>
<span class="k">FROM</span> <span class="p">(</span><span class="ss">&quot;t0&quot;</span><span class="p">.</span><span class="ss">&quot;res0&quot;</span><span class="p">)</span>
</pre></div>

        </div>
    
        </div>
    
                </div>
                    </p>
<p>Due to the monadic structure, putting the filtered aggregate as the second
clause in the JOIN causes the HAVING to be floated out, because the compiler
can't prove that the conditional expression only depends on the results of the
aggregate.</p>
<p>
                <div class="code-nav-container">
                    
        <ul class="nav nav-tabs">
            
        <li class="nav-item">
            <a href="#tab-6-Haskell" aria-controls="tab-6-Haskell" role="tab" data-toggle="tab" data-lang="haskell">Haskell</a>
        </li>
    
        <li class="nav-item">
            <a href="#tab-6-Sqlite" aria-controls="tab-6-Sqlite" role="tab" data-toggle="tab" data-lang="sql">Sqlite</a>
        </li>
    
        <li class="nav-item">
            <a href="#tab-6-Postgres" aria-controls="tab-6-Postgres" role="tab" data-toggle="tab" data-lang="sql">Postgres</a>
        </li>
    
        </ul>
    
        <div class="tab-content">
            
        <div role="tabpanel" class="tab-pane active" id="tab-6-Haskell">
            <div class="codehilite"><pre><span></span><span class="c1">-- Only return results for genres whose total track length is over 5 minutes</span>
<span class="kr">do</span> <span class="n">track_</span> <span class="ow">&lt;-</span> <span class="n">all_</span> <span class="p">(</span><span class="n">track</span> <span class="n">chinookDb</span><span class="p">)</span>
   <span class="p">(</span><span class="n">genre</span><span class="p">,</span> <span class="n">priceCnt</span><span class="p">,</span> <span class="n">trackLength</span><span class="p">)</span> <span class="ow">&lt;-</span>
            <span class="n">filter_</span> <span class="p">(</span><span class="nf">\</span><span class="p">(</span><span class="n">genre</span><span class="p">,</span> <span class="n">distinctPriceCount</span><span class="p">,</span> <span class="n">totalTrackLength</span><span class="p">)</span> <span class="ow">-&gt;</span> <span class="n">totalTrackLength</span> <span class="o">&gt;=.</span> <span class="mi">300000</span><span class="p">)</span> <span class="o">$</span>
            <span class="n">aggregate_</span> <span class="p">(</span><span class="nf">\</span><span class="p">(</span><span class="n">genre</span><span class="p">,</span> <span class="n">track</span><span class="p">)</span> <span class="ow">-&gt;</span>
                          <span class="p">(</span> <span class="n">group_</span> <span class="n">genre</span>
                          <span class="p">,</span> <span class="n">as_</span> <span class="o">@</span><span class="kt">Int</span> <span class="o">$</span> <span class="n">countOver_</span> <span class="n">distinctInGroup_</span> <span class="p">(</span><span class="n">trackUnitPrice</span> <span class="n">track</span><span class="p">)</span>
                          <span class="p">,</span> <span class="n">fromMaybe_</span> <span class="mi">0</span> <span class="p">(</span><span class="n">sumOver_</span> <span class="n">allInGroupExplicitly_</span> <span class="p">(</span><span class="n">trackMilliseconds</span> <span class="n">track</span><span class="p">))</span> <span class="p">`</span><span class="n">div_</span><span class="p">`</span> <span class="mi">1000</span> <span class="p">))</span> <span class="o">$</span>
            <span class="p">((,)</span> <span class="o">&lt;$&gt;</span> <span class="n">all_</span> <span class="p">(</span><span class="n">genre</span> <span class="n">chinookDb</span><span class="p">)</span> <span class="o">&lt;*&gt;</span> <span class="n">all_</span> <span class="p">(</span><span class="n">track</span> <span class="n">chinookDb</span><span class="p">))</span>
   <span class="n">guard_</span> <span class="p">(</span><span class="n">trackGenreId</span> <span class="n">track_</span> <span class="o">==.</span> <span class="n">just_</span> <span class="p">(</span><span class="n">pk</span> <span class="n">genre</span><span class="p">))</span>
   <span class="n">pure</span> <span class="p">(</span><span class="n">genre</span><span class="p">,</span> <span class="n">track_</span><span class="p">,</span> <span class="n">priceCnt</span><span class="p">,</span> <span class="n">trackLength</span><span class="p">)</span>
</pre></div>

        </div>
    
        <div role="tabpanel" class="tab-pane " id="tab-6-Sqlite">
            <div class="codehilite"><pre><span></span><span class="k">SELECT</span> <span class="ss">&quot;t1&quot;</span><span class="p">.</span><span class="ss">&quot;res0&quot;</span> <span class="k">AS</span> <span class="ss">&quot;res0&quot;</span><span class="p">,</span>
       <span class="ss">&quot;t1&quot;</span><span class="p">.</span><span class="ss">&quot;res1&quot;</span> <span class="k">AS</span> <span class="ss">&quot;res1&quot;</span><span class="p">,</span>
       <span class="ss">&quot;t0&quot;</span><span class="p">.</span><span class="ss">&quot;TrackId&quot;</span> <span class="k">AS</span> <span class="ss">&quot;res2&quot;</span><span class="p">,</span>
       <span class="ss">&quot;t0&quot;</span><span class="p">.</span><span class="ss">&quot;Name&quot;</span> <span class="k">AS</span> <span class="ss">&quot;res3&quot;</span><span class="p">,</span>
       <span class="ss">&quot;t0&quot;</span><span class="p">.</span><span class="ss">&quot;AlbumId&quot;</span> <span class="k">AS</span> <span class="ss">&quot;res4&quot;</span><span class="p">,</span>
       <span class="ss">&quot;t0&quot;</span><span class="p">.</span><span class="ss">&quot;MediaTypeId&quot;</span> <span class="k">AS</span> <span class="ss">&quot;res5&quot;</span><span class="p">,</span>
       <span class="ss">&quot;t0&quot;</span><span class="p">.</span><span class="ss">&quot;GenreId&quot;</span> <span class="k">AS</span> <span class="ss">&quot;res6&quot;</span><span class="p">,</span>
       <span class="ss">&quot;t0&quot;</span><span class="p">.</span><span class="ss">&quot;Composer&quot;</span> <span class="k">AS</span> <span class="ss">&quot;res7&quot;</span><span class="p">,</span>
       <span class="ss">&quot;t0&quot;</span><span class="p">.</span><span class="ss">&quot;Milliseconds&quot;</span> <span class="k">AS</span> <span class="ss">&quot;res8&quot;</span><span class="p">,</span>
       <span class="ss">&quot;t0&quot;</span><span class="p">.</span><span class="ss">&quot;Bytes&quot;</span> <span class="k">AS</span> <span class="ss">&quot;res9&quot;</span><span class="p">,</span>
       <span class="ss">&quot;t0&quot;</span><span class="p">.</span><span class="ss">&quot;UnitPrice&quot;</span> <span class="k">AS</span> <span class="ss">&quot;res10&quot;</span><span class="p">,</span>
       <span class="ss">&quot;t1&quot;</span><span class="p">.</span><span class="ss">&quot;res2&quot;</span> <span class="k">AS</span> <span class="ss">&quot;res11&quot;</span><span class="p">,</span>
       <span class="ss">&quot;t1&quot;</span><span class="p">.</span><span class="ss">&quot;res3&quot;</span> <span class="k">AS</span> <span class="ss">&quot;res12&quot;</span>
<span class="k">FROM</span> <span class="ss">&quot;Track&quot;</span> <span class="k">AS</span> <span class="ss">&quot;t0&quot;</span>
<span class="k">INNER</span> <span class="k">JOIN</span>
  <span class="p">(</span><span class="k">SELECT</span> <span class="ss">&quot;t0&quot;</span><span class="p">.</span><span class="ss">&quot;GenreId&quot;</span> <span class="k">AS</span> <span class="ss">&quot;res0&quot;</span><span class="p">,</span>
          <span class="ss">&quot;t0&quot;</span><span class="p">.</span><span class="ss">&quot;Name&quot;</span> <span class="k">AS</span> <span class="ss">&quot;res1&quot;</span><span class="p">,</span>
          <span class="k">COUNT</span><span class="p">(</span><span class="k">DISTINCT</span> <span class="ss">&quot;t1&quot;</span><span class="p">.</span><span class="ss">&quot;UnitPrice&quot;</span><span class="p">)</span> <span class="k">AS</span> <span class="ss">&quot;res2&quot;</span><span class="p">,</span>
          <span class="p">(</span><span class="n">COALESCE</span><span class="p">(</span><span class="k">SUM</span><span class="p">(</span><span class="k">ALL</span> <span class="ss">&quot;t1&quot;</span><span class="p">.</span><span class="ss">&quot;Milliseconds&quot;</span><span class="p">),</span> <span class="o">?</span><span class="p">))</span> <span class="o">/</span> <span class="p">(</span><span class="o">?</span><span class="p">)</span> <span class="k">AS</span> <span class="ss">&quot;res3&quot;</span>
   <span class="k">FROM</span> <span class="ss">&quot;Genre&quot;</span> <span class="k">AS</span> <span class="ss">&quot;t0&quot;</span>
   <span class="k">INNER</span> <span class="k">JOIN</span> <span class="ss">&quot;Track&quot;</span> <span class="k">AS</span> <span class="ss">&quot;t1&quot;</span>
   <span class="k">GROUP</span> <span class="k">BY</span> <span class="ss">&quot;t0&quot;</span><span class="p">.</span><span class="ss">&quot;GenreId&quot;</span><span class="p">,</span>
            <span class="ss">&quot;t0&quot;</span><span class="p">.</span><span class="ss">&quot;Name&quot;</span><span class="p">)</span> <span class="k">AS</span> <span class="ss">&quot;t1&quot;</span>
<span class="k">WHERE</span> <span class="p">((</span><span class="ss">&quot;t1&quot;</span><span class="p">.</span><span class="ss">&quot;res3&quot;</span><span class="p">)</span><span class="o">&gt;=</span><span class="p">(</span><span class="o">?</span><span class="p">))</span>
  <span class="k">AND</span> <span class="p">(</span><span class="k">CASE</span>
           <span class="k">WHEN</span> <span class="p">((</span><span class="ss">&quot;t0&quot;</span><span class="p">.</span><span class="ss">&quot;GenreId&quot;</span><span class="p">)</span> <span class="k">IS</span> <span class="k">NULL</span><span class="p">)</span>
                <span class="k">AND</span> <span class="p">((</span><span class="ss">&quot;t1&quot;</span><span class="p">.</span><span class="ss">&quot;res0&quot;</span><span class="p">)</span> <span class="k">IS</span> <span class="k">NULL</span><span class="p">)</span> <span class="k">THEN</span> <span class="o">?</span>
           <span class="k">WHEN</span> <span class="p">((</span><span class="ss">&quot;t0&quot;</span><span class="p">.</span><span class="ss">&quot;GenreId&quot;</span><span class="p">)</span> <span class="k">IS</span> <span class="k">NULL</span><span class="p">)</span>
                <span class="k">OR</span> <span class="p">((</span><span class="ss">&quot;t1&quot;</span><span class="p">.</span><span class="ss">&quot;res0&quot;</span><span class="p">)</span> <span class="k">IS</span> <span class="k">NULL</span><span class="p">)</span> <span class="k">THEN</span> <span class="o">?</span>
           <span class="k">ELSE</span> <span class="p">(</span><span class="ss">&quot;t0&quot;</span><span class="p">.</span><span class="ss">&quot;GenreId&quot;</span><span class="p">)</span><span class="o">=</span><span class="p">(</span><span class="ss">&quot;t1&quot;</span><span class="p">.</span><span class="ss">&quot;res0&quot;</span><span class="p">)</span>
       <span class="k">END</span><span class="p">);</span>

<span class="c1">-- With values: [SQLInteger 0,SQLInteger 1000,SQLInteger 300000,SQLInteger 1,SQLInteger 0]</span>
</pre></div>

        </div>
    
        <div role="tabpanel" class="tab-pane " id="tab-6-Postgres">
            <div class="codehilite"><pre><span></span><span class="k">SELECT</span> <span class="ss">&quot;t1&quot;</span><span class="p">.</span><span class="ss">&quot;res0&quot;</span> <span class="k">AS</span> <span class="ss">&quot;res0&quot;</span><span class="p">,</span>
       <span class="ss">&quot;t1&quot;</span><span class="p">.</span><span class="ss">&quot;res1&quot;</span> <span class="k">AS</span> <span class="ss">&quot;res1&quot;</span><span class="p">,</span>
       <span class="ss">&quot;t0&quot;</span><span class="p">.</span><span class="ss">&quot;TrackId&quot;</span> <span class="k">AS</span> <span class="ss">&quot;res2&quot;</span><span class="p">,</span>
       <span class="ss">&quot;t0&quot;</span><span class="p">.</span><span class="ss">&quot;Name&quot;</span> <span class="k">AS</span> <span class="ss">&quot;res3&quot;</span><span class="p">,</span>
       <span class="ss">&quot;t0&quot;</span><span class="p">.</span><span class="ss">&quot;AlbumId&quot;</span> <span class="k">AS</span> <span class="ss">&quot;res4&quot;</span><span class="p">,</span>
       <span class="ss">&quot;t0&quot;</span><span class="p">.</span><span class="ss">&quot;MediaTypeId&quot;</span> <span class="k">AS</span> <span class="ss">&quot;res5&quot;</span><span class="p">,</span>
       <span class="ss">&quot;t0&quot;</span><span class="p">.</span><span class="ss">&quot;GenreId&quot;</span> <span class="k">AS</span> <span class="ss">&quot;res6&quot;</span><span class="p">,</span>
       <span class="ss">&quot;t0&quot;</span><span class="p">.</span><span class="ss">&quot;Composer&quot;</span> <span class="k">AS</span> <span class="ss">&quot;res7&quot;</span><span class="p">,</span>
       <span class="ss">&quot;t0&quot;</span><span class="p">.</span><span class="ss">&quot;Milliseconds&quot;</span> <span class="k">AS</span> <span class="ss">&quot;res8&quot;</span><span class="p">,</span>
       <span class="ss">&quot;t0&quot;</span><span class="p">.</span><span class="ss">&quot;Bytes&quot;</span> <span class="k">AS</span> <span class="ss">&quot;res9&quot;</span><span class="p">,</span>
       <span class="ss">&quot;t0&quot;</span><span class="p">.</span><span class="ss">&quot;UnitPrice&quot;</span> <span class="k">AS</span> <span class="ss">&quot;res10&quot;</span><span class="p">,</span>
       <span class="ss">&quot;t1&quot;</span><span class="p">.</span><span class="ss">&quot;res2&quot;</span> <span class="k">AS</span> <span class="ss">&quot;res11&quot;</span><span class="p">,</span>
       <span class="ss">&quot;t1&quot;</span><span class="p">.</span><span class="ss">&quot;res3&quot;</span> <span class="k">AS</span> <span class="ss">&quot;res12&quot;</span>
<span class="k">FROM</span> <span class="ss">&quot;Track&quot;</span> <span class="k">AS</span> <span class="ss">&quot;t0&quot;</span>
<span class="k">CROSS</span> <span class="k">JOIN</span>
  <span class="p">(</span><span class="k">SELECT</span> <span class="ss">&quot;t0&quot;</span><span class="p">.</span><span class="ss">&quot;GenreId&quot;</span> <span class="k">AS</span> <span class="ss">&quot;res0&quot;</span><span class="p">,</span>
          <span class="ss">&quot;t0&quot;</span><span class="p">.</span><span class="ss">&quot;Name&quot;</span> <span class="k">AS</span> <span class="ss">&quot;res1&quot;</span><span class="p">,</span>
          <span class="k">COUNT</span><span class="p">(</span><span class="k">DISTINCT</span> <span class="ss">&quot;t1&quot;</span><span class="p">.</span><span class="ss">&quot;UnitPrice&quot;</span><span class="p">)</span> <span class="k">AS</span> <span class="ss">&quot;res2&quot;</span><span class="p">,</span>
          <span class="p">(</span><span class="n">COALESCE</span><span class="p">(</span><span class="k">SUM</span><span class="p">(</span><span class="k">ALL</span> <span class="ss">&quot;t1&quot;</span><span class="p">.</span><span class="ss">&quot;Milliseconds&quot;</span><span class="p">),</span> <span class="mi">0</span><span class="p">))</span> <span class="o">/</span> <span class="p">(</span><span class="mi">1000</span><span class="p">)</span> <span class="k">AS</span> <span class="ss">&quot;res3&quot;</span>
   <span class="k">FROM</span> <span class="ss">&quot;Genre&quot;</span> <span class="k">AS</span> <span class="ss">&quot;t0&quot;</span>
   <span class="k">CROSS</span> <span class="k">JOIN</span> <span class="ss">&quot;Track&quot;</span> <span class="k">AS</span> <span class="ss">&quot;t1&quot;</span>
   <span class="k">GROUP</span> <span class="k">BY</span> <span class="ss">&quot;t0&quot;</span><span class="p">.</span><span class="ss">&quot;GenreId&quot;</span><span class="p">,</span>
            <span class="ss">&quot;t0&quot;</span><span class="p">.</span><span class="ss">&quot;Name&quot;</span><span class="p">)</span> <span class="k">AS</span> <span class="ss">&quot;t1&quot;</span>
<span class="k">WHERE</span> <span class="p">((</span><span class="ss">&quot;t1&quot;</span><span class="p">.</span><span class="ss">&quot;res3&quot;</span><span class="p">)</span> <span class="o">&gt;=</span> <span class="p">(</span><span class="mi">300000</span><span class="p">))</span>
  <span class="k">AND</span> <span class="p">((</span><span class="ss">&quot;t0&quot;</span><span class="p">.</span><span class="ss">&quot;GenreId&quot;</span><span class="p">)</span> <span class="k">IS</span> <span class="k">NOT</span> <span class="k">DISTINCT</span>
       <span class="k">FROM</span> <span class="p">(</span><span class="ss">&quot;t1&quot;</span><span class="p">.</span><span class="ss">&quot;res0&quot;</span><span class="p">))</span>
</pre></div>

        </div>
    
        </div>
    
                </div>
                    </p>
<p>You can prove to the compiler that the <code>filter_</code> should generate a having by
using the <code>subselect_</code> combinator.</p>
<p>
                <div class="code-nav-container">
                    
        <ul class="nav nav-tabs">
            
        <li class="nav-item">
            <a href="#tab-24-Haskell" aria-controls="tab-24-Haskell" role="tab" data-toggle="tab" data-lang="haskell">Haskell</a>
        </li>
    
        <li class="nav-item">
            <a href="#tab-24-Sqlite" aria-controls="tab-24-Sqlite" role="tab" data-toggle="tab" data-lang="sql">Sqlite</a>
        </li>
    
        <li class="nav-item">
            <a href="#tab-24-Postgres" aria-controls="tab-24-Postgres" role="tab" data-toggle="tab" data-lang="sql">Postgres</a>
        </li>
    
        </ul>
    
        <div class="tab-content">
            
        <div role="tabpanel" class="tab-pane active" id="tab-24-Haskell">
            <div class="codehilite"><pre><span></span><span class="c1">-- Only return results for genres whose total track length is over 5 minutes</span>
<span class="kr">do</span> <span class="n">track_</span> <span class="ow">&lt;-</span> <span class="n">all_</span> <span class="p">(</span><span class="n">track</span> <span class="n">chinookDb</span><span class="p">)</span>
   <span class="p">(</span><span class="n">genre</span><span class="p">,</span> <span class="n">priceCnt</span><span class="p">,</span> <span class="n">trackLength</span><span class="p">)</span> <span class="ow">&lt;-</span>
            <span class="n">subselect_</span> <span class="o">$</span>
            <span class="n">filter_</span> <span class="p">(</span><span class="nf">\</span><span class="p">(</span><span class="n">genre</span><span class="p">,</span> <span class="n">distinctPriceCount</span><span class="p">,</span> <span class="n">totalTrackLength</span><span class="p">)</span> <span class="ow">-&gt;</span> <span class="n">totalTrackLength</span> <span class="o">&gt;=.</span> <span class="mi">300000</span><span class="p">)</span> <span class="o">$</span>
            <span class="n">aggregate_</span> <span class="p">(</span><span class="nf">\</span><span class="p">(</span><span class="n">genre</span><span class="p">,</span> <span class="n">track</span><span class="p">)</span> <span class="ow">-&gt;</span>
                          <span class="p">(</span> <span class="n">group_</span> <span class="n">genre</span>
                          <span class="p">,</span> <span class="n">as_</span> <span class="o">@</span><span class="kt">Int</span> <span class="o">$</span> <span class="n">countOver_</span> <span class="n">distinctInGroup_</span> <span class="p">(</span><span class="n">trackUnitPrice</span> <span class="n">track</span><span class="p">)</span>
                          <span class="p">,</span> <span class="n">fromMaybe_</span> <span class="mi">0</span> <span class="p">(</span><span class="n">sumOver_</span> <span class="n">allInGroupExplicitly_</span> <span class="p">(</span><span class="n">trackMilliseconds</span> <span class="n">track</span><span class="p">))</span> <span class="p">`</span><span class="n">div_</span><span class="p">`</span> <span class="mi">1000</span> <span class="p">))</span> <span class="o">$</span>
            <span class="p">((,)</span> <span class="o">&lt;$&gt;</span> <span class="n">all_</span> <span class="p">(</span><span class="n">genre</span> <span class="n">chinookDb</span><span class="p">)</span> <span class="o">&lt;*&gt;</span> <span class="n">all_</span> <span class="p">(</span><span class="n">track</span> <span class="n">chinookDb</span><span class="p">))</span>
   <span class="n">guard_</span> <span class="p">(</span><span class="n">trackGenreId</span> <span class="n">track_</span> <span class="o">==.</span> <span class="n">just_</span> <span class="p">(</span><span class="n">pk</span> <span class="n">genre</span><span class="p">))</span>
   <span class="n">pure</span> <span class="p">(</span><span class="n">genre</span><span class="p">,</span> <span class="n">track_</span><span class="p">,</span> <span class="n">priceCnt</span><span class="p">,</span> <span class="n">trackLength</span><span class="p">)</span>
</pre></div>

        </div>
    
        <div role="tabpanel" class="tab-pane " id="tab-24-Sqlite">
            <div class="codehilite"><pre><span></span><span class="k">SELECT</span> <span class="ss">&quot;t1&quot;</span><span class="p">.</span><span class="ss">&quot;res0&quot;</span> <span class="k">AS</span> <span class="ss">&quot;res0&quot;</span><span class="p">,</span>
       <span class="ss">&quot;t1&quot;</span><span class="p">.</span><span class="ss">&quot;res1&quot;</span> <span class="k">AS</span> <span class="ss">&quot;res1&quot;</span><span class="p">,</span>
       <span class="ss">&quot;t0&quot;</span><span class="p">.</span><span class="ss">&quot;TrackId&quot;</span> <span class="k">AS</span> <span class="ss">&quot;res2&quot;</span><span class="p">,</span>
       <span class="ss">&quot;t0&quot;</span><span class="p">.</span><span class="ss">&quot;Name&quot;</span> <span class="k">AS</span> <span class="ss">&quot;res3&quot;</span><span class="p">,</span>
       <span class="ss">&quot;t0&quot;</span><span class="p">.</span><span class="ss">&quot;AlbumId&quot;</span> <span class="k">AS</span> <span class="ss">&quot;res4&quot;</span><span class="p">,</span>
       <span class="ss">&quot;t0&quot;</span><span class="p">.</span><span class="ss">&quot;MediaTypeId&quot;</span> <span class="k">AS</span> <span class="ss">&quot;res5&quot;</span><span class="p">,</span>
       <span class="ss">&quot;t0&quot;</span><span class="p">.</span><span class="ss">&quot;GenreId&quot;</span> <span class="k">AS</span> <span class="ss">&quot;res6&quot;</span><span class="p">,</span>
       <span class="ss">&quot;t0&quot;</span><span class="p">.</span><span class="ss">&quot;Composer&quot;</span> <span class="k">AS</span> <span class="ss">&quot;res7&quot;</span><span class="p">,</span>
       <span class="ss">&quot;t0&quot;</span><span class="p">.</span><span class="ss">&quot;Milliseconds&quot;</span> <span class="k">AS</span> <span class="ss">&quot;res8&quot;</span><span class="p">,</span>
       <span class="ss">&quot;t0&quot;</span><span class="p">.</span><span class="ss">&quot;Bytes&quot;</span> <span class="k">AS</span> <span class="ss">&quot;res9&quot;</span><span class="p">,</span>
       <span class="ss">&quot;t0&quot;</span><span class="p">.</span><span class="ss">&quot;UnitPrice&quot;</span> <span class="k">AS</span> <span class="ss">&quot;res10&quot;</span><span class="p">,</span>
       <span class="ss">&quot;t1&quot;</span><span class="p">.</span><span class="ss">&quot;res2&quot;</span> <span class="k">AS</span> <span class="ss">&quot;res11&quot;</span><span class="p">,</span>
       <span class="ss">&quot;t1&quot;</span><span class="p">.</span><span class="ss">&quot;res3&quot;</span> <span class="k">AS</span> <span class="ss">&quot;res12&quot;</span>
<span class="k">FROM</span> <span class="ss">&quot;Track&quot;</span> <span class="k">AS</span> <span class="ss">&quot;t0&quot;</span>
<span class="k">INNER</span> <span class="k">JOIN</span>
  <span class="p">(</span><span class="k">SELECT</span> <span class="ss">&quot;t0&quot;</span><span class="p">.</span><span class="ss">&quot;res0&quot;</span> <span class="k">AS</span> <span class="ss">&quot;res0&quot;</span><span class="p">,</span>
          <span class="ss">&quot;t0&quot;</span><span class="p">.</span><span class="ss">&quot;res1&quot;</span> <span class="k">AS</span> <span class="ss">&quot;res1&quot;</span><span class="p">,</span>
          <span class="ss">&quot;t0&quot;</span><span class="p">.</span><span class="ss">&quot;res2&quot;</span> <span class="k">AS</span> <span class="ss">&quot;res2&quot;</span><span class="p">,</span>
          <span class="ss">&quot;t0&quot;</span><span class="p">.</span><span class="ss">&quot;res3&quot;</span> <span class="k">AS</span> <span class="ss">&quot;res3&quot;</span>
   <span class="k">FROM</span>
     <span class="p">(</span><span class="k">SELECT</span> <span class="ss">&quot;t0&quot;</span><span class="p">.</span><span class="ss">&quot;GenreId&quot;</span> <span class="k">AS</span> <span class="ss">&quot;res0&quot;</span><span class="p">,</span>
             <span class="ss">&quot;t0&quot;</span><span class="p">.</span><span class="ss">&quot;Name&quot;</span> <span class="k">AS</span> <span class="ss">&quot;res1&quot;</span><span class="p">,</span>
             <span class="k">COUNT</span><span class="p">(</span><span class="k">DISTINCT</span> <span class="ss">&quot;t1&quot;</span><span class="p">.</span><span class="ss">&quot;UnitPrice&quot;</span><span class="p">)</span> <span class="k">AS</span> <span class="ss">&quot;res2&quot;</span><span class="p">,</span>
             <span class="p">(</span><span class="n">COALESCE</span><span class="p">(</span><span class="k">SUM</span><span class="p">(</span><span class="k">ALL</span> <span class="ss">&quot;t1&quot;</span><span class="p">.</span><span class="ss">&quot;Milliseconds&quot;</span><span class="p">),</span> <span class="o">?</span><span class="p">))</span> <span class="o">/</span> <span class="p">(</span><span class="o">?</span><span class="p">)</span> <span class="k">AS</span> <span class="ss">&quot;res3&quot;</span>
      <span class="k">FROM</span> <span class="ss">&quot;Genre&quot;</span> <span class="k">AS</span> <span class="ss">&quot;t0&quot;</span>
      <span class="k">INNER</span> <span class="k">JOIN</span> <span class="ss">&quot;Track&quot;</span> <span class="k">AS</span> <span class="ss">&quot;t1&quot;</span>
      <span class="k">GROUP</span> <span class="k">BY</span> <span class="ss">&quot;t0&quot;</span><span class="p">.</span><span class="ss">&quot;GenreId&quot;</span><span class="p">,</span>
               <span class="ss">&quot;t0&quot;</span><span class="p">.</span><span class="ss">&quot;Name&quot;</span>
      <span class="k">HAVING</span> <span class="p">((</span><span class="n">COALESCE</span><span class="p">(</span><span class="k">SUM</span><span class="p">(</span><span class="k">ALL</span> <span class="ss">&quot;t1&quot;</span><span class="p">.</span><span class="ss">&quot;Milliseconds&quot;</span><span class="p">),</span> <span class="o">?</span><span class="p">))</span> <span class="o">/</span> <span class="p">(</span><span class="o">?</span><span class="p">))</span><span class="o">&gt;=</span><span class="p">(</span><span class="o">?</span><span class="p">))</span> <span class="k">AS</span> <span class="ss">&quot;t0&quot;</span><span class="p">)</span> <span class="k">AS</span> <span class="ss">&quot;t1&quot;</span>
<span class="k">WHERE</span> <span class="k">CASE</span>
          <span class="k">WHEN</span> <span class="p">((</span><span class="ss">&quot;t0&quot;</span><span class="p">.</span><span class="ss">&quot;GenreId&quot;</span><span class="p">)</span> <span class="k">IS</span> <span class="k">NULL</span><span class="p">)</span>
               <span class="k">AND</span> <span class="p">((</span><span class="ss">&quot;t1&quot;</span><span class="p">.</span><span class="ss">&quot;res0&quot;</span><span class="p">)</span> <span class="k">IS</span> <span class="k">NULL</span><span class="p">)</span> <span class="k">THEN</span> <span class="o">?</span>
          <span class="k">WHEN</span> <span class="p">((</span><span class="ss">&quot;t0&quot;</span><span class="p">.</span><span class="ss">&quot;GenreId&quot;</span><span class="p">)</span> <span class="k">IS</span> <span class="k">NULL</span><span class="p">)</span>
               <span class="k">OR</span> <span class="p">((</span><span class="ss">&quot;t1&quot;</span><span class="p">.</span><span class="ss">&quot;res0&quot;</span><span class="p">)</span> <span class="k">IS</span> <span class="k">NULL</span><span class="p">)</span> <span class="k">THEN</span> <span class="o">?</span>
          <span class="k">ELSE</span> <span class="p">(</span><span class="ss">&quot;t0&quot;</span><span class="p">.</span><span class="ss">&quot;GenreId&quot;</span><span class="p">)</span><span class="o">=</span><span class="p">(</span><span class="ss">&quot;t1&quot;</span><span class="p">.</span><span class="ss">&quot;res0&quot;</span><span class="p">)</span>
      <span class="k">END</span><span class="p">;</span>

<span class="c1">-- With values: [SQLInteger 0,SQLInteger 1000,SQLInteger 0,SQLInteger 1000,SQLInteger 300000,SQLInteger 1,SQLInteger 0]</span>
</pre></div>

        </div>
    
        <div role="tabpanel" class="tab-pane " id="tab-24-Postgres">
            <div class="codehilite"><pre><span></span><span class="k">SELECT</span> <span class="ss">&quot;t1&quot;</span><span class="p">.</span><span class="ss">&quot;res0&quot;</span> <span class="k">AS</span> <span class="ss">&quot;res0&quot;</span><span class="p">,</span>
       <span class="ss">&quot;t1&quot;</span><span class="p">.</span><span class="ss">&quot;res1&quot;</span> <span class="k">AS</span> <span class="ss">&quot;res1&quot;</span><span class="p">,</span>
       <span class="ss">&quot;t0&quot;</span><span class="p">.</span><span class="ss">&quot;TrackId&quot;</span> <span class="k">AS</span> <span class="ss">&quot;res2&quot;</span><span class="p">,</span>
       <span class="ss">&quot;t0&quot;</span><span class="p">.</span><span class="ss">&quot;Name&quot;</span> <span class="k">AS</span> <span class="ss">&quot;res3&quot;</span><span class="p">,</span>
       <span class="ss">&quot;t0&quot;</span><span class="p">.</span><span class="ss">&quot;AlbumId&quot;</span> <span class="k">AS</span> <span class="ss">&quot;res4&quot;</span><span class="p">,</span>
       <span class="ss">&quot;t0&quot;</span><span class="p">.</span><span class="ss">&quot;MediaTypeId&quot;</span> <span class="k">AS</span> <span class="ss">&quot;res5&quot;</span><span class="p">,</span>
       <span class="ss">&quot;t0&quot;</span><span class="p">.</span><span class="ss">&quot;GenreId&quot;</span> <span class="k">AS</span> <span class="ss">&quot;res6&quot;</span><span class="p">,</span>
       <span class="ss">&quot;t0&quot;</span><span class="p">.</span><span class="ss">&quot;Composer&quot;</span> <span class="k">AS</span> <span class="ss">&quot;res7&quot;</span><span class="p">,</span>
       <span class="ss">&quot;t0&quot;</span><span class="p">.</span><span class="ss">&quot;Milliseconds&quot;</span> <span class="k">AS</span> <span class="ss">&quot;res8&quot;</span><span class="p">,</span>
       <span class="ss">&quot;t0&quot;</span><span class="p">.</span><span class="ss">&quot;Bytes&quot;</span> <span class="k">AS</span> <span class="ss">&quot;res9&quot;</span><span class="p">,</span>
       <span class="ss">&quot;t0&quot;</span><span class="p">.</span><span class="ss">&quot;UnitPrice&quot;</span> <span class="k">AS</span> <span class="ss">&quot;res10&quot;</span><span class="p">,</span>
       <span class="ss">&quot;t1&quot;</span><span class="p">.</span><span class="ss">&quot;res2&quot;</span> <span class="k">AS</span> <span class="ss">&quot;res11&quot;</span><span class="p">,</span>
       <span class="ss">&quot;t1&quot;</span><span class="p">.</span><span class="ss">&quot;res3&quot;</span> <span class="k">AS</span> <span class="ss">&quot;res12&quot;</span>
<span class="k">FROM</span> <span class="ss">&quot;Track&quot;</span> <span class="k">AS</span> <span class="ss">&quot;t0&quot;</span>
<span class="k">CROSS</span> <span class="k">JOIN</span>
  <span class="p">(</span><span class="k">SELECT</span> <span class="ss">&quot;t0&quot;</span><span class="p">.</span><span class="ss">&quot;res0&quot;</span> <span class="k">AS</span> <span class="ss">&quot;res0&quot;</span><span class="p">,</span>
          <span class="ss">&quot;t0&quot;</span><span class="p">.</span><span class="ss">&quot;res1&quot;</span> <span class="k">AS</span> <span class="ss">&quot;res1&quot;</span><span class="p">,</span>
          <span class="ss">&quot;t0&quot;</span><span class="p">.</span><span class="ss">&quot;res2&quot;</span> <span class="k">AS</span> <span class="ss">&quot;res2&quot;</span><span class="p">,</span>
          <span class="ss">&quot;t0&quot;</span><span class="p">.</span><span class="ss">&quot;res3&quot;</span> <span class="k">AS</span> <span class="ss">&quot;res3&quot;</span>
   <span class="k">FROM</span>
     <span class="p">(</span><span class="k">SELECT</span> <span class="ss">&quot;t0&quot;</span><span class="p">.</span><span class="ss">&quot;GenreId&quot;</span> <span class="k">AS</span> <span class="ss">&quot;res0&quot;</span><span class="p">,</span>
             <span class="ss">&quot;t0&quot;</span><span class="p">.</span><span class="ss">&quot;Name&quot;</span> <span class="k">AS</span> <span class="ss">&quot;res1&quot;</span><span class="p">,</span>
             <span class="k">COUNT</span><span class="p">(</span><span class="k">DISTINCT</span> <span class="ss">&quot;t1&quot;</span><span class="p">.</span><span class="ss">&quot;UnitPrice&quot;</span><span class="p">)</span> <span class="k">AS</span> <span class="ss">&quot;res2&quot;</span><span class="p">,</span>
             <span class="p">(</span><span class="n">COALESCE</span><span class="p">(</span><span class="k">SUM</span><span class="p">(</span><span class="k">ALL</span> <span class="ss">&quot;t1&quot;</span><span class="p">.</span><span class="ss">&quot;Milliseconds&quot;</span><span class="p">),</span> <span class="mi">0</span><span class="p">))</span> <span class="o">/</span> <span class="p">(</span><span class="mi">1000</span><span class="p">)</span> <span class="k">AS</span> <span class="ss">&quot;res3&quot;</span>
      <span class="k">FROM</span> <span class="ss">&quot;Genre&quot;</span> <span class="k">AS</span> <span class="ss">&quot;t0&quot;</span>
      <span class="k">CROSS</span> <span class="k">JOIN</span> <span class="ss">&quot;Track&quot;</span> <span class="k">AS</span> <span class="ss">&quot;t1&quot;</span>
      <span class="k">GROUP</span> <span class="k">BY</span> <span class="ss">&quot;t0&quot;</span><span class="p">.</span><span class="ss">&quot;GenreId&quot;</span><span class="p">,</span>
               <span class="ss">&quot;t0&quot;</span><span class="p">.</span><span class="ss">&quot;Name&quot;</span>
      <span class="k">HAVING</span> <span class="p">((</span><span class="n">COALESCE</span><span class="p">(</span><span class="k">SUM</span><span class="p">(</span><span class="k">ALL</span> <span class="ss">&quot;t1&quot;</span><span class="p">.</span><span class="ss">&quot;Milliseconds&quot;</span><span class="p">),</span> <span class="mi">0</span><span class="p">))</span> <span class="o">/</span> <span class="p">(</span><span class="mi">1000</span><span class="p">))</span> <span class="o">&gt;=</span> <span class="p">(</span><span class="mi">300000</span><span class="p">))</span> <span class="k">AS</span> <span class="ss">&quot;t0&quot;</span><span class="p">)</span> <span class="k">AS</span> <span class="ss">&quot;t1&quot;</span>
<span class="k">WHERE</span> <span class="p">(</span><span class="ss">&quot;t0&quot;</span><span class="p">.</span><span class="ss">&quot;GenreId&quot;</span><span class="p">)</span> <span class="k">IS</span> <span class="k">NOT</span> <span class="k">DISTINCT</span>
  <span class="k">FROM</span> <span class="p">(</span><span class="ss">&quot;t1&quot;</span><span class="p">.</span><span class="ss">&quot;res0&quot;</span><span class="p">)</span>
</pre></div>

        </div>
    
        </div>
    
                </div>
                    </p>
                
                  
                
              
              
                
              
            </article>
          </div>
        </div>
      </main>
      
        
<footer class="md-footer">
  
    <div class="md-footer-nav">
      <nav class="md-footer-nav__inner md-grid">
        
          <a href="../relationships/" title="Relationships" class="md-flex md-footer-nav__link md-footer-nav__link--prev" rel="prev">
            <div class="md-flex__cell md-flex__cell--shrink">
              <i class="md-icon md-icon--arrow-back md-footer-nav__button"></i>
            </div>
            <div class="md-flex__cell md-flex__cell--stretch md-footer-nav__title">
              <span class="md-flex__ellipsis">
                <span class="md-footer-nav__direction">
                  Previous
                </span>
                Relationships
              </span>
            </div>
          </a>
        
        
          <a href="../combining-queries/" title="Combining queries" class="md-flex md-footer-nav__link md-footer-nav__link--next" rel="next">
            <div class="md-flex__cell md-flex__cell--stretch md-footer-nav__title">
              <span class="md-flex__ellipsis">
                <span class="md-footer-nav__direction">
                  Next
                </span>
                Combining queries
              </span>
            </div>
            <div class="md-flex__cell md-flex__cell--shrink">
              <i class="md-icon md-icon--arrow-forward md-footer-nav__button"></i>
            </div>
          </a>
        
      </nav>
    </div>
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-footer-copyright">
        
        powered by
        <a href="http://www.mkdocs.org" title="MkDocs">MkDocs</a>
        and
        <a href="http://squidfunk.github.io/mkdocs-material/" title="Material for MkDocs">
          Material for MkDocs</a>
      </div>
      
        
      
    </div>
  </div>
</footer>
      
    </div>
    

      <script src="../../../assets/javascripts/application-6b599127bc.js"></script>
      <script>app.initialize({url:{base:"../../.."}})</script>
      
    
<script type="text/javascript" language="javascript"  src="https://code.jquery.com/jquery-2.2.4.min.js"></script>
<script type="text/javascript" language="javascript" src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js"></script>
<script type="text/javascript" language="javascript">
 $(document.body).tab();
 $(".nav-item:first-child").tab("show");
</script>

    
      
    
  </body>
</html>