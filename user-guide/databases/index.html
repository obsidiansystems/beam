
<!DOCTYPE html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
      
        <link rel="shortcut icon" href="../../assets/images/favicon.png">
      
      <meta name="generator" content="mkdocs-0.16.2, mkdocs-material-1.6.1">
    
    
      
        <title>Databases - Beam Documentation</title>
      
    
    
      <script src="../../assets/javascripts/modernizr-56ade86843.js"></script>
    
    

      <link rel="stylesheet" href="../../assets/stylesheets/application-4d0d3f2fbf.css">
      
    
<link rel="stylesheet" type="text/css" href="/css/beam.css"/>

    
      
        
        
        
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,400,400i,700|Roboto+Mono">
        <style>body,input{font-family:"Roboto","Helvetica Neue",Helvetica,Arial,sans-serif}code,kbd,pre{font-family:"Roboto Mono","Courier New",Courier,monospace}</style>
      
      <link rel="stylesheet" href="https://fonts.googleapis.com/icon?family=Material+Icons">
    
    
      <link rel="stylesheet" href="../../theme/css/beam.css">
    
    
  </head>
  
  
  
  
    <body>
  
    <svg class="md-svg">
      <defs>
        
        
          <svg xmlns="http://www.w3.org/2000/svg" width="416" height="448" viewBox="0 0 416 448" id="github"><path fill="currentColor" d="M160 304q0 10-3.125 20.5t-10.75 19T128 352t-18.125-8.5-10.75-19T96 304t3.125-20.5 10.75-19T128 256t18.125 8.5 10.75 19T160 304zm160 0q0 10-3.125 20.5t-10.75 19T288 352t-18.125-8.5-10.75-19T256 304t3.125-20.5 10.75-19T288 256t18.125 8.5 10.75 19T320 304zm40 0q0-30-17.25-51T296 232q-10.25 0-48.75 5.25Q229.5 240 208 240t-39.25-2.75Q130.75 232 120 232q-29.5 0-46.75 21T56 304q0 22 8 38.375t20.25 25.75 30.5 15 35 7.375 37.25 1.75h42q20.5 0 37.25-1.75t35-7.375 30.5-15 20.25-25.75T360 304zm56-44q0 51.75-15.25 82.75-9.5 19.25-26.375 33.25t-35.25 21.5-42.5 11.875-42.875 5.5T212 416q-19.5 0-35.5-.75t-36.875-3.125-38.125-7.5-34.25-12.875T37 371.5t-21.5-28.75Q0 312 0 260q0-59.25 34-99-6.75-20.5-6.75-42.5 0-29 12.75-54.5 27 0 47.5 9.875t47.25 30.875Q171.5 96 212 96q37 0 70 8 26.25-20.5 46.75-30.25T376 64q12.75 25.5 12.75 54.5 0 21.75-6.75 42 34 40 34 99.5z"/></svg>
        
      </defs>
    </svg>
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="drawer">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="search">
    <label class="md-overlay" data-md-component="overlay" for="drawer"></label>
    
      <header class="md-header" data-md-component="header">
  <nav class="md-header-nav md-grid">
    <div class="md-flex">
      <div class="md-flex__cell md-flex__cell--shrink">
        
          <a href="../.." title="Beam Documentation" class="md-logo md-header-nav__button">
            <img src="../../img/logo.svg" width="24" height="24">
          </a>
        
      </div>
      <div class="md-flex__cell md-flex__cell--shrink">
        <label class="md-icon md-icon--menu md-header-nav__button" for="drawer"></label>
      </div>
      <div class="md-flex__cell md-flex__cell--stretch">
        <span class="md-flex__ellipsis md-header-nav__title">
          
            
              
                <span class="md-header-nav__parent">
                  User Guide
                </span>
              
            
            Databases
          
        </span>
      </div>
      <div class="md-flex__cell md-flex__cell--shrink">
        
          <label class="md-icon md-icon--search md-header-nav__button" for="search"></label>
          
<div class="md-search" data-md-component="search">
  <label class="md-search__overlay" for="search"></label>
  <div class="md-search__inner">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" required placeholder="Search" accesskey="s" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="query">
      <label class="md-icon md-search__icon" for="search"></label>
      <button type="reset" class="md-icon md-search__icon" data-md-component="reset">close</button>
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="result">
          <div class="md-search-result__meta" data-md-lang-result-none="No matching documents" data-md-lang-result-one="1 matching document" data-md-lang-result-other="# matching documents">
            Type to start searching
          </div>
          <ol class="md-search-result__list"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
        
      </div>
      <div class="md-flex__cell md-flex__cell--shrink">
        <div class="md-header-nav__source">
          
            


  


  <a href="https://github.com/tathougies/beam" title="Go to repository" class="md-source" data-md-source="github">
    
      <div class="md-source__icon">
        <svg viewBox="0 0 24 24" width="24" height="24">
          <use xlink:href="#github" width="24" height="24"></use>
        </svg>
      </div>
    
    <div class="md-source__repository">
      tathougies/beam
    </div>
  </a>

          
        </div>
      </div>
    </div>
  </nav>
</header>
    
    <div class="md-container">
      
      
      <main class="md-main">
        <div class="md-main__inner md-grid" data-md-component="container">
          
            
              <div class="md-sidebar md-sidebar--primary" data-md-component="navigation">
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    <nav class="md-nav md-nav--primary" data-md-level="0">
  <label class="md-nav__title md-nav__title--site" for="drawer">
    
      <i class="md-logo md-nav__button">
        <img src="../../img/logo.svg">
      </i>
    
    Beam Documentation
  </label>
  
    <div class="md-nav__source">
      


  


  <a href="https://github.com/tathougies/beam" title="Go to repository" class="md-source" data-md-source="github">
    
      <div class="md-source__icon">
        <svg viewBox="0 0 24 24" width="24" height="24">
          <use xlink:href="#github" width="24" height="24"></use>
        </svg>
      </div>
    
    <div class="md-source__repository">
      tathougies/beam
    </div>
  </a>

    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
      


  <li class="md-nav__item">
    <a href="../.." title="Home" class="md-nav__link">
      Home
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../../about/faq/" title="Frequently Asked Questions" class="md-nav__link">
      Frequently Asked Questions
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-3" type="checkbox" id="nav-3">
    
    <label class="md-nav__link" for="nav-3">
      Tutorial
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-3">
        Tutorial
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../tutorials/tutorial1/" title="Part 1" class="md-nav__link">
      Part 1
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../tutorials/tutorial2/" title="Part 2" class="md-nav__link">
      Part 2
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../tutorials/tutorial3/" title="Part 3" class="md-nav__link">
      Part 3
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      

  


  <li class="md-nav__item md-nav__item--active md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-4" type="checkbox" id="nav-4" checked>
    
    <label class="md-nav__link" for="nav-4">
      User Guide
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-4">
        User Guide
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../models/" title="Models" class="md-nav__link">
      Models
    </a>
  </li>

        
          
          
          

  


  <li class="md-nav__item md-nav__item--active">
    
    <input class="md-toggle md-nav__toggle" data-md-toggle="toc" type="checkbox" id="toc">
    
    
      <label class="md-nav__link md-nav__link--active" for="toc">
        Databases
      </label>
    
    <a href="./" title="Databases" class="md-nav__link md-nav__link--active">
      Databases
    </a>
    
      
<nav class="md-nav md-nav--secondary">
  
  
  
    <label class="md-nav__title" for="toc">Table of contents</label>
    <ul class="md-nav__list" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#a-simple-database-type" title="A simple database type" class="md-nav__link">
    A simple database type
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#other-database-entities" title="Other database entities" class="md-nav__link">
    Other database entities
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#views" title="Views" class="md-nav__link">
    Views
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#domain-types" title="Domain types" class="md-nav__link">
    Domain types
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#character-sets" title="Character sets" class="md-nav__link">
    Character sets
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#collations" title="Collations" class="md-nav__link">
    Collations
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#translations" title="Translations" class="md-nav__link">
    Translations
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#other-database-entities_1" title="Other database entities" class="md-nav__link">
    Other database entities
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#database-descriptors" title="Database descriptors" class="md-nav__link">
    Database descriptors
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#modifying-the-defaults" title="Modifying the defaults" class="md-nav__link">
    Modifying the defaults
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
      
      
    </ul>
  
</nav>
    
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../backends/" title="Backends" class="md-nav__link">
      Backends
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../expressions/" title="Expressions" class="md-nav__link">
      Expressions
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-4-5" type="checkbox" id="nav-4-5">
    
    <label class="md-nav__link" for="nav-4-5">
      Queries
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="2">
      <label class="md-nav__title" for="nav-4-5">
        Queries
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../queries/basic/" title="Basic Queries" class="md-nav__link">
      Basic Queries
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../queries/select/" title="More complex SELECTs" class="md-nav__link">
      More complex SELECTs
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../queries/ordering/" title="Ordering" class="md-nav__link">
      Ordering
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../queries/relationships/" title="Relationships" class="md-nav__link">
      Relationships
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../queries/aggregates/" title="Aggregates" class="md-nav__link">
      Aggregates
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../queries/combining-queries/" title="Combining queries" class="md-nav__link">
      Combining queries
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../queries/window-functions/" title="Window functions" class="md-nav__link">
      Window functions
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../queries/advanced-features/" title="Advanced features" class="md-nav__link">
      Advanced features
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../extensibility/" title="Custom queries" class="md-nav__link">
      Custom queries
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-4-7" type="checkbox" id="nav-4-7">
    
    <label class="md-nav__link" for="nav-4-7">
      Data Manipulation
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="2">
      <label class="md-nav__title" for="nav-4-7">
        Data Manipulation
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../manipulation/insert/" title="INSERT" class="md-nav__link">
      INSERT
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../manipulation/update/" title="UPDATE" class="md-nav__link">
      UPDATE
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../manipulation/delete/" title="DELETE" class="md-nav__link">
      DELETE
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-5" type="checkbox" id="nav-5">
    
    <label class="md-nav__link" for="nav-5">
      Schema management
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-5">
        Schema management
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../schema-guide/migrations/" title="The Migrations Framework" class="md-nav__link">
      The Migrations Framework
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../schema-guide/tool/" title="The beam-migrate tool" class="md-nav__link">
      The beam-migrate tool
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../schema-guide/supported/" title="Supported migrations" class="md-nav__link">
      Supported migrations
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-6" type="checkbox" id="nav-6">
    
    <label class="md-nav__link" for="nav-6">
      Backends
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-6">
        Backends
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../backends/beam-postgres/" title="beam-postgres" class="md-nav__link">
      beam-postgres
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../backends/beam-sqlite/" title="beam-sqlite" class="md-nav__link">
      beam-sqlite
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../custom-backends/" title="Writing a Custom Backend" class="md-nav__link">
      Writing a Custom Backend
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-7" type="checkbox" id="nav-7">
    
    <label class="md-nav__link" for="nav-7">
      About
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-7">
        About
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../about/compatibility/" title="Compatibility Matrix" class="md-nav__link">
      Compatibility Matrix
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../about/license/" title="License" class="md-nav__link">
      License
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../about/release-notes/" title="Release Notes" class="md-nav__link">
      Release Notes
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              <div class="md-sidebar md-sidebar--secondary" data-md-component="toc">
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    
<nav class="md-nav md-nav--secondary">
  
  
  
    <label class="md-nav__title" for="toc">Table of contents</label>
    <ul class="md-nav__list" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#a-simple-database-type" title="A simple database type" class="md-nav__link">
    A simple database type
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#other-database-entities" title="Other database entities" class="md-nav__link">
    Other database entities
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#views" title="Views" class="md-nav__link">
    Views
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#domain-types" title="Domain types" class="md-nav__link">
    Domain types
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#character-sets" title="Character sets" class="md-nav__link">
    Character sets
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#collations" title="Collations" class="md-nav__link">
    Collations
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#translations" title="Translations" class="md-nav__link">
    Translations
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#other-database-entities_1" title="Other database entities" class="md-nav__link">
    Other database entities
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#database-descriptors" title="Database descriptors" class="md-nav__link">
    Database descriptors
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#modifying-the-defaults" title="Modifying the defaults" class="md-nav__link">
    Modifying the defaults
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
      
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          <div class="md-content">
            <article class="md-content__inner md-typeset">
              
                
                
                  <h1>Databases</h1>
                
                <p>In addition to defining types for each of your tables, beam also
requires you to declare your database as a type with fields for
holding all entities in your database. This includes more than just
tables. For example, user-defined types that you would like to work
with must also be included in your database type.</p>
<h2 id="a-simple-database-type">A simple database type</h2>
<p>Like tables, a database type takes a functor and applies it to each
entity in the database. For example, a database type for the two
tables defined above has the form.</p>
<div class="codehilite"><pre><span></span><span class="kr">data</span> <span class="kt">ExampleDb</span> <span class="n">f</span>
    <span class="ow">=</span> <span class="kt">ExampleDb</span>
    <span class="p">{</span> <span class="n">persons</span> <span class="ow">::</span> <span class="n">f</span> <span class="p">(</span><span class="kt">TableEntity</span> <span class="kt">PersonT</span><span class="p">)</span>
    <span class="p">,</span> <span class="n">posts</span>   <span class="ow">::</span> <span class="n">f</span> <span class="p">(</span><span class="kt">TableEntity</span> <span class="kt">PersonT</span><span class="p">)</span>
    <span class="p">}</span> <span class="kr">deriving</span> <span class="kt">Generic</span>
<span class="kr">instance</span> <span class="kt">Database</span> <span class="n">be</span> <span class="kt">ExampleDb</span>

<span class="nf">exampleDb</span> <span class="ow">::</span> <span class="kt">DatabaseSettings</span> <span class="n">be</span> <span class="kt">ExampleDb</span>
<span class="nf">exampleDb</span> <span class="ow">=</span> <span class="n">defaultDbSettings</span>
</pre></div>


<h2 id="other-database-entities">Other database entities</h2>
<h3 id="views">Views</h3>
<p>Some databases also offer the concept of 'views' -- pseudo-tables that
are built from a pre-defined query. Suppose we wanted to create a view
that returned the latest comments and their respective posters.</p>
<div class="codehilite"><pre><span></span><span class="kr">data</span> <span class="kt">PostAndPosterView</span> <span class="n">f</span>
    <span class="ow">=</span> <span class="kt">PostAndPosterView</span>
    <span class="p">{</span> <span class="n">post</span>   <span class="ow">::</span> <span class="kt">PostT</span> <span class="n">f</span>
    <span class="p">,</span> <span class="n">poster</span> <span class="ow">::</span> <span class="kt">PersonT</span> <span class="n">f</span>
    <span class="p">}</span> <span class="kr">deriving</span> <span class="kt">Generic</span>
<span class="kr">instance</span> <span class="kt">Beamable</span> <span class="kt">PostAndPosterView</span>
</pre></div>


<p>We can include this in our database:</p>
<div class="codehilite"><pre><span></span><span class="kr">data</span> <span class="kt">ExampleDb</span> <span class="n">f</span>
    <span class="ow">=</span> <span class="kt">ExampleDb</span>
    <span class="p">{</span> <span class="n">persons</span>        <span class="ow">::</span> <span class="n">f</span> <span class="p">(</span><span class="kt">TableEntity</span> <span class="kt">PersonT</span><span class="p">)</span>
    <span class="p">,</span> <span class="n">posts</span>          <span class="ow">::</span> <span class="n">f</span> <span class="p">(</span><span class="kt">TableEntity</span> <span class="kt">PersonT</span><span class="p">)</span>
    <span class="p">,</span> <span class="n">postAndPosters</span> <span class="ow">::</span> <span class="n">f</span> <span class="p">(</span><span class="kt">ViewEntity</span> <span class="kt">PostAndPosterView</span><span class="p">)</span>
    <span class="p">}</span> <span class="kr">deriving</span> <span class="kt">Generic</span>
</pre></div>


<p>Now we can use <code>postAndPosters</code> wherever we'd use a table. Note that you do not
need to specify the definition of the view. The definition is not important to
access the view, so beam does not need to know about it at the type-level. If
you want to manipulate view definitions, use the migrations package.</p>
<p>Note that the <code>all_</code> query primitive requires a <code>TableEntity</code>. Thus, <code>all_
(postAndPosters exampleDb)</code> will fail to type-check. Use the <code>allFromView_</code>
combinator instead.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>You could also declare a view as a <code>TableEntity</code>. The main advantage of
declaring an entity as <code>ViewEntity</code> is that you will be prevented by the
Haskell type system from constructing <code>INSERT</code>s, <code>UPDATE</code>s, and <code>DELETE</code>s
using your view. Also, <code>beam-migrate</code> will not recognize database schema
equivalence if a view is declared as a table or vice versa.</p>
</div>
<!-- ### Unique constraints -->

<!-- !!! note "Note" -->

<!--     This is the current implementation plan. Uniques are not currently implemented. -->

<!-- The `TableEntityWithUnique` database entity allows you to declare -->

<!-- tables with additional uniqueness constraints (the primary key is -->

<!-- considered to be unique by default). -->

<!-- For example, suppose you wanted to re-define the `PersonT` table with -->

<!-- an additional unique e-mail and another unique phone column. -->

<!-- ```haskell -->

<!-- data PersonT f -->

<!--     = Person -->

<!--     { personFirstName :: Columnar f Text -->

<!--     , personLastName  :: Columnar f Text -->

<!--     , personAge       :: Columnar f Int -->

<!--     , personEmail     :: Columnar f Text -->

<!--     , personPhone     :: Columnar f Text -->

<!--     } deriving Generic -->

<!-- data PersonByEmail f = PersonByEmail (Columnar f Text) -->

<!-- data PersonByPhone f = PersonByPhone (Columnar f Text) -->

<!-- ``` -->

<!-- Now, use `TableEntityWithUnique` to declare the table. -->

<!-- ```haskell -->

<!-- data ExampleDb f -->

<!--     = ExampleDb -->

<!--     { persons        :: f (TableEntityWithUnique PersonT '[PersonByEmail, PersonByPhone]) -->

<!--     , posts          :: f (TableEntity PersonT) -->

<!--     , postAndPosters :: f (ViewEntity PostAndPosterView) -->

<!--     } deriving Generic -->

<!-- ``` -->

<!-- Beam will not complain about this definition, but you will need to -->

<!-- declare additional instances in order to actually use the unique -->

<!-- constraints. -->

<!-- ```haskell -->

<!-- instance Unique PersonT PersonByEmail where -->

<!--   mkUnique = PersonByEmail . personEmail -->

<!-- instance Unique PersonT PersonByPhone where -->

<!--   mkUnique = PersonByPhone . personPhone -->

<!-- ``` -->

<!-- *TODO*: Should the unique constraints be declared at the database or table level? -->

<h3 id="domain-types">Domain types</h3>
<p>Domain types are a way of creating new database types with additional
constraints. Beam supports declaring these types as part of your
database, so they can be used anywhere a data type can. In order to
use your domain type, you need to supply beam a Haskell newtype that
is used to represent values of this type in Haskell.</p>
<h3 id="character-sets">Character sets</h3>
<p>Beam does not yet support character sets. Support is planned in future releases.</p>
<h3 id="collations">Collations</h3>
<p>Beam does not yet support collations. Support is planned in future releases.</p>
<h3 id="translations">Translations</h3>
<p>Beam does not yet support translations. Support is planned in future releases.</p>
<h3 id="other-database-entities_1">Other database entities</h3>
<p>Other standard SQL database entities (like triggers) are defined by
<code>beam-migrate</code> as they have no effect on query semantics.</p>
<h2 id="database-descriptors">Database descriptors</h2>
<p>In order to interact with the database, beam needs to know more about
the data structure, it also needs to know how to refer to each entity
in your database. For the most part, beam can figure out the names for
you using its Generics-based defaulting mechanims. Once you have a
database type defined, you can create a database descriptor using the
<code>defaultDbSettings</code> function.</p>
<p>For example, to create a backend-agnostic database descriptor for the
<code>ExampleDb</code> type:</p>
<div class="codehilite"><pre><span></span><span class="nf">exampleDb</span> <span class="ow">::</span> <span class="kt">DatabaseSettings</span> <span class="n">be</span> <span class="kt">ExampleDb</span>
<span class="nf">exampleDb</span> <span class="ow">=</span> <span class="n">defaultDbSettings</span>
</pre></div>


<p>The <code>defaultDbSettings</code> function produces a settings value where each entity is
given a default name as explained in the <a href="../models/">previous section</a>.</p>
<p>Now, we can use the entities in <code>exampleDb</code> to write queries. The
rules for name defaulting for database entities are the same as those
for <a href="../models/#defaults">table fields</a></p>
<h3 id="modifying-the-defaults">Modifying the defaults</h3>
<p>The <code>withDbModification</code> function can be used to modify the output of the
<code>defaultDbSettings</code>. It combines a database settings value with a <em>database
modifications value</em>. The easiest way to construct a database modification value
is with the <code>dbModification</code> function, which produces a modification that makes
no changes.</p>
<p>You can then use Haskell record syntax to specify table or other entity
modifications. For example, the <code>modifyTable</code> function can be used to produce a
table modification given a modifier function for the table name and a table
modification. Like database modifications, an identity table modification can be
constructed with the <code>tableModification</code> function. Modifications to field names
con be accomplished using Haskell record syntax on the result of
<code>tableModification</code>. The <code>fieldNamed</code> field modification will give a field an
explicit new name.</p>
<p>For example, to rename the <code>persons</code> table as <code>people</code> in the database above,</p>
<div class="codehilite"><pre><span></span><span class="nf">exampleDb</span> <span class="ow">::</span> <span class="kt">DatabaseSettings</span> <span class="n">be</span> <span class="kt">ExampleDb</span>
<span class="nf">exampleDb</span> <span class="ow">=</span> <span class="n">defaultDbSettings</span> <span class="p">`</span><span class="n">withDbModification</span><span class="p">`</span>
            <span class="n">dbModification</span> <span class="p">{</span>
              <span class="n">persons</span> <span class="ow">=</span> <span class="n">modifyTable</span> <span class="p">(</span><span class="nf">\</span><span class="kr">_</span> <span class="ow">-&gt;</span> <span class="s">&quot;people&quot;</span><span class="p">)</span> <span class="n">tableModification</span>
            <span class="p">}</span>
</pre></div>


<p>Or, to keep the <code>persons</code> table named as it is, but change the name of the <code>personEmail</code> field from <code>"email"</code> to <code>"email_address"</code></p>
<div class="codehilite"><pre><span></span><span class="nf">exampleDb</span> <span class="ow">::</span> <span class="kt">DatabaseSettings</span> <span class="n">be</span> <span class="kt">ExampleDb</span>
<span class="nf">exampleDb</span> <span class="ow">=</span> <span class="n">defaultDbSettings</span> <span class="p">`</span><span class="n">withDbModification</span><span class="p">`</span>
            <span class="n">dbModification</span> <span class="p">{</span>
              <span class="n">persons</span> <span class="ow">=</span> <span class="n">modifyTable</span> <span class="n">id</span> <span class="o">$</span>
                        <span class="n">tableModification</span> <span class="p">{</span>
                          <span class="n">personEmail</span> <span class="ow">=</span> <span class="n">fieldNamed</span> <span class="s">&quot;email_address&quot;</span>
                        <span class="p">}</span>
            <span class="p">}</span>
</pre></div>


<p>An appropriate <code>IsString</code> instance is also given so you can avoid the use of
<code>fieldNamed</code>. For example, the above is equivalent to</p>
<div class="codehilite"><pre><span></span><span class="nf">exampleDb</span> <span class="ow">::</span> <span class="kt">DatabaseSettings</span> <span class="n">be</span> <span class="kt">ExampleDb</span>
<span class="nf">exampleDb</span> <span class="ow">=</span> <span class="n">defaultDbSettings</span> <span class="p">`</span><span class="n">withDbModification</span><span class="p">`</span>
            <span class="n">dbModification</span> <span class="p">{</span>
              <span class="n">persons</span> <span class="ow">=</span> <span class="n">modifyTable</span> <span class="n">id</span> <span class="o">$</span>
                        <span class="n">tableModification</span> <span class="p">{</span>
                          <span class="n">personEmail</span> <span class="ow">=</span> <span class="s">&quot;email_address&quot;</span>
                        <span class="p">}</span>
            <span class="p">}</span>
</pre></div>
                
                  
                
              
              
                
              
            </article>
          </div>
        </div>
      </main>
      
        
<footer class="md-footer">
  
    <div class="md-footer-nav">
      <nav class="md-footer-nav__inner md-grid">
        
          <a href="../models/" title="Models" class="md-flex md-footer-nav__link md-footer-nav__link--prev" rel="prev">
            <div class="md-flex__cell md-flex__cell--shrink">
              <i class="md-icon md-icon--arrow-back md-footer-nav__button"></i>
            </div>
            <div class="md-flex__cell md-flex__cell--stretch md-footer-nav__title">
              <span class="md-flex__ellipsis">
                <span class="md-footer-nav__direction">
                  Previous
                </span>
                Models
              </span>
            </div>
          </a>
        
        
          <a href="../backends/" title="Backends" class="md-flex md-footer-nav__link md-footer-nav__link--next" rel="next">
            <div class="md-flex__cell md-flex__cell--stretch md-footer-nav__title">
              <span class="md-flex__ellipsis">
                <span class="md-footer-nav__direction">
                  Next
                </span>
                Backends
              </span>
            </div>
            <div class="md-flex__cell md-flex__cell--shrink">
              <i class="md-icon md-icon--arrow-forward md-footer-nav__button"></i>
            </div>
          </a>
        
      </nav>
    </div>
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-footer-copyright">
        
        powered by
        <a href="http://www.mkdocs.org" title="MkDocs">MkDocs</a>
        and
        <a href="http://squidfunk.github.io/mkdocs-material/" title="Material for MkDocs">
          Material for MkDocs</a>
      </div>
      
        
      
    </div>
  </div>
</footer>
      
    </div>
    

      <script src="../../assets/javascripts/application-6b599127bc.js"></script>
      <script>app.initialize({url:{base:"../.."}})</script>
      
    
<script type="text/javascript" language="javascript"  src="https://code.jquery.com/jquery-2.2.4.min.js"></script>
<script type="text/javascript" language="javascript" src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js"></script>
<script type="text/javascript" language="javascript">
 $(document.body).tab();
 $(".nav-item:first-child").tab("show");
</script>

    
      
    
  </body>
</html>